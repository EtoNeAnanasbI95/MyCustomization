import{r as s,j as e,R as C,c as jt}from"./client-45b27fd3.js";import{c as Ge,v as Ke,R as it,E as se,d as Je,W as wt,l as Tt,b as He,g as Et}from"./index-9b1f0f42.js";import{L as Ct}from"./hook-ae816606.js";import{L as at,r as de,c as ge,U as ot,V as kt}from"./index-825701e8.js";import{a as me,A as Rt}from"./index-37dc4817.js";import{c as G}from"./index-203ce83a.js";import{f as B,a as ct}from"./analytics-46c41402.js";import{u as Ze}from"./useAsyncWithPromise-6dde1473.js";import{c as lt,s as ye,Y as ue,P as Z,h as ut,U as n,d as ke,f as _t,C as A,e as xe,i as It,j as zt,k as At,l as Xe,m as Mt,a as Ot,n as et,T as Dt}from"./postMessageConstants-347e1d65.js";import{I as Ut,g as Lt}from"./getYoutubeVideoContextData-8dfce505.js";import{q as Re,a as Ft}from"./backend-b5a741e2.js";import{G as Yt}from"./globalInfoBanner-9dda3b2e.js";import{F as Bt}from"./index-fa8b2430.js";import{u as te}from"./useTranslation-c38a45bb.js";import{I as Pt,a as $t}from"./IconBrandTwitter-e8b4a1ff.js";import{I as Gt}from"./IconBrandMedium-8b3318a3.js";import{G as tt,p as Ht,M as qt,D as Ye}from"./index-0e364fed.js";import{m as M}from"./motion-2f15212b.js";import{I as dt}from"./IconRefresh-c267e433.js";import{c as mt}from"./createReactComponent-d14705e3.js";import{A as X}from"./index-39fb8d8a.js";import{I as pt}from"./IconChevronDown-c0174c21.js";import{T as Be}from"./webAccessTooltip-5740d933.js";import{C as rt}from"./index-00cb779e.js";import{Q as Wt}from"./index-107bf8b6.js";import{u as Qt}from"./useOnClickOutside-4f6061f4.js";import{I as Vt}from"./IconCopy-3f3f64da.js";import{I as st}from"./IconBlockquote-41067608.js";import{c as Kt}from"./index-5c33a703.js";import{P as Jt}from"./PersistQueryClientProvider-53edff98.js";import"./utils-01642ffa.js";import"./IconThumbUp-e2c311b9.js";import"./languageLogoMap-9be38ce0.js";import"./foyerLogo-7f07d1ff.js";import"./useSharedUserSettings-04e5c292.js";import"./useMutation-24b8df85.js";import"./useUserSettings-c0487dc5.js";import"./IconQuestionMark-483d2d08.js";import"./IconLanguage-57b34183.js";import"./IconChevronRight-f54b4a77.js";import"./IconCheck-740a5f2a.js";import"./IconSettings-4208f539.js";var Zt=mt("message","IconMessage",[["path",{d:"M8 9h8",key:"svg-0"}],["path",{d:"M8 13h6",key:"svg-1"}],["path",{d:"M18 4a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-5l-5 3v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12z",key:"svg-2"}]]),Xt=mt("quote","IconQuote",[["path",{d:"M10 11h-4a1 1 0 0 1 -1 -1v-3a1 1 0 0 1 1 -1h3a1 1 0 0 1 1 1v6c0 2.667 -1.333 4.333 -4 5",key:"svg-0"}],["path",{d:"M19 11h-4a1 1 0 0 1 -1 -1v-3a1 1 0 0 1 1 -1h3a1 1 0 0 1 1 1v6c0 2.667 -1.333 4.333 -4 5",key:"svg-1"}]]);function ft(t){const r=s.useRef();return s.useEffect(()=>{r.current=t},[t]),r.current}var ht=(t=>(t.START="start",t.END="end",t))(ht||{});function er(t){const[r,i]=s.useState(window.location.href),a=ft(r);return document.addEventListener(`yt-navigate-${t}`,()=>{a!==window.location.href&&i(window.location.href)}),a!==r?r:null}const tr=()=>{const t=s.useRef(!0);return s.useEffect(()=>{t.current=!1},[]),t.current},rr=async(t,r,i,a,c=!0,f=!1,j={})=>{var y,q,L;const u=Re.getQueryData(["sharedUserSettings"]),x=await at.get("extVersion"),H=(y=u==null?void 0:u.apiKey)!=null&&y.enabled&&((q=u==null?void 0:u.apiKey)!=null&&q.value)?{apiKey:(L=u==null?void 0:u.apiKey)==null?void 0:L.value}:{},k=await fetch(`${Ge.DOMAIN}/summarize/youtube?&customJWT=true`,{body:JSON.stringify({estimatedQueryCost:a,language:u.language||"AUTO",useCache:c,videoId:i,...H,isWhisper:f,videoContext:j}),headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json","x-merlin-version":`extension-${x}`},method:"POST",signal:r}),m=await k.json();if(m.status==="success"||m.status==="warning")return m!=null&&m.data&&(m.data.requestIdHeader=k.headers.get("x-request-id")),m;throw m.status==="error"?m.error:new Error("Unknown error")},sr=async(t,r,i)=>{const a=await at.get("extVersion");try{const f=await(await fetch(`${Ge.DOMAIN}/utility/manageCache`,{body:JSON.stringify({videoId:i}),headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json","x-merlin-version":`extension-${a}`},method:"POST",signal:r})).json();if(f.status==="success")return f.data;if(f.status==="error")throw f.error}catch(c){throw new Error(`Failed to get batches for video ID ${i}: ${c.message}`)}},nr=async(t,r)=>{const i=Re.getQueryData(["sharedUserSettings"]);try{const c=await(await fetch(`${Ge.DOMAIN}/subtitles`,{body:JSON.stringify({lang:Ke[i==null?void 0:i.language]||Ke.ENGLISH,videoID:t,whisper:r}),headers:{"Content-Type":"application/json"},method:"POST"})).json();return c.status==="success"?c.data:c.status==="error"?{error:c.error}:{error:"Something went wrong. Please try again later!"}}catch(a){return{error:a||"something went wrong"}}},ir=({queryCost:t})=>{const{t:r}=te(),i=()=>{window.parent.postMessage({data:{openTweetifyInChat:!0},type:it.YOUTUBE_SUMMARY},"*"),B({eventName:"TweetifyMainButton",eventType:"Button",feature:"YoutubeSummarizer",firedFromFile:"components/tweetify/TweetifyButton"})};return e.jsx("div",{className:"my-4 flex w-full items-center justify-center",children:e.jsxs("button",{onClick:i,className:"border-cornblue-600 dark:bg-background relative flex h-[50px] w-[93%] items-center justify-center gap-3 rounded border bg-zinc-50 p-2",type:"button",children:[e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx("span",{className:"flex h-8 w-8 translate-x-[4px] items-center justify-center rounded-full bg-[#1c9ceb]",children:e.jsx(Pt,{className:"stroke-white dark:stroke-current",size:19})}),e.jsx("span",{className:"flex h-8 w-8 translate-x-[2px] items-center justify-center rounded-full bg-[#0e72a3]",children:e.jsx($t,{className:"stroke-white dark:stroke-current",size:22})}),e.jsx("span",{className:"flex h-8 w-8 items-center justify-center rounded-full border-white bg-neutral-800",children:e.jsx(Gt,{className:"stroke-white dark:stroke-current",size:23})})]}),e.jsx("span",{children:r("tweetify.create_tweet")})]})})},nt=t=>{const{t:r}=te(),{...i}=s.useContext(me),{changeConfirmState:a,handleSummarize:c,queryCost:f,setIsSummaryCollapsed:j}=t;return s.useEffect(()=>{lt()},[]),e.jsxs("div",{className:"flex min-h-[56px] items-center justify-between gap-2 px-3 py-1.5",children:[e.jsxs("div",{className:"text-sm",children:[r("yt_lib.vid_without_subs")," ",f||4," ",de(i.usageDetails.type)?"words":"queries","."," ",r("yt_lib.wish_to_proceed")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"c-transition-colors items-center gap-1 rounded border border-zinc-300 bg-emerald-500  px-2 py-1 shadow-md hover:bg-emerald-600 dark:border-zinc-700 dark:bg-emerald-600 hover:dark:bg-emerald-700",onClick:()=>{c(!0),B({eventName:"YoutubeSummarizeButton",eventType:"Button",feature:"YoutubeSummaryContainer",firedFromFile:"content-migrated/youtubeSummary/YoutubeSummaryContainer"})},children:r("yes")}),e.jsx("button",{type:"button",className:"c-transition-colors items-center gap-1 rounded border border-zinc-400 bg-zinc-300 px-2 py-1 shadow-md hover:bg-zinc-400 dark:border-zinc-700 dark:bg-zinc-600 hover:dark:bg-zinc-700",onClick:()=>{a([!1,"SIDE"]),j(!0),ye({action:ue.RESET_HIGHLIGHTS_BUTTON,type:Z.FROM_YT_SUMMARIZER})},children:r("no")})]})]})},ar=t=>{const{t:r}=te(),{UI_STATES:i,authDetails:a,errorMessage:c,errorType:f,summaryState:j}=t;if(a.isAuthenticated&&j===i.ERROR&&f===se.RATE_LIMITED)return e.jsxs(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"flex flex-col items-center justify-center gap-2 rounded-b-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-4 text-base",children:[e.jsx("div",{className:"text-3xl",children:"ðŸ˜­"}),e.jsx("div",{children:r("yt_lib.error1")})]}),e.jsx(tt,{text:"Merlin Dashboard",onClick:()=>{ge(Je+"?from=go-pro-errorui")}})]});if(a.isAuthenticated&&j===i.ERROR&&(f===se.WHISPER_ERROR||f===se.LESS_SPEECH_ERROR))return e.jsx(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"flex flex-col items-center justify-center gap-2 rounded-b-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-4 text-base",children:[e.jsx("div",{className:"text-3xl",children:"ðŸ˜­"}),e.jsx("div",{children:f===se.WHISPER_ERROR?wt[c]||"Our apologies, but we're unable to generate a summary for this video at the moment.":f===se.LESS_SPEECH_ERROR?Tt:""})]})});if(a.isAuthenticated&&j===i.ERROR&&f===se.PAID_FEATURE)return e.jsxs(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"flex flex-col items-center justify-center gap-2 rounded-b-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-4 text-base",children:[e.jsx("div",{className:"text-3xl",children:"ðŸ˜­"}),e.jsx("div",{children:r("yt_lib.error2")})]}),e.jsx(tt,{text:"Merlin Dashboard",onClick:()=>{ge(Je+"?from=go-pro-errorui")}})]});if(a.isAuthenticated&&j===i.ERROR)return e.jsxs(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"flex flex-col items-center justify-center gap-2 rounded-b-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-4 text-base",children:[e.jsx("div",{className:"text-3xl",children:"ðŸ˜­"}),e.jsx("div",{children:r("yt_lib.error3")})]}),e.jsxs("div",{className:"flex w-fit cursor-pointer items-center justify-center gap-2 rounded-lg bg-zinc-200 px-4 py-2 text-zinc-700 dark:bg-zinc-700 dark:text-zinc-300",onClick:()=>{window.location.reload()},children:[e.jsx("div",{children:e.jsx(dt,{size:16,strokeWidth:1.5})}),e.jsx("div",{children:r("yt_lib.error4")})]})]})};function Pe(){return e.jsx("svg",{viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M4.5 6.75L9 11.25L13.5 6.75",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})})}function $e(){return e.jsx("svg",{viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M4.5 11.25L9 6.75L13.5 11.25",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})})}const or=({summaryData:t})=>{const{t:r}=te(),{email:i,token:a}=s.useContext(me),c=s.useCallback(()=>{ut(t,a,i),ye({action:ue.SET_HIGHLIGHTS_SUCCESS,type:Z.FROM_YT_SUMMARIZER}),B({eventName:"CommentKeyPointsButton",eventType:"Button",feature:"YoutubeSummarizer",firedFromFile:"src/features/youtubeSummarizer/CommentKeyPointers"})},[t,a,i]);return e.jsxs("button",{onClick:c,type:"button",className:"border-cornblue-600 dark:bg-background group relative z-50 flex w-full items-center justify-center gap-2 rounded-md border bg-zinc-50 p-2",children:[e.jsx(Zt,{size:20}),e.jsx("span",{children:r("yt_lib.comment_key")})]})},cr=t=>{const{changeExpandedTimestamp:r,expandedTimestamp:i,hoveringTimestamp:a,isSummaryCollapsed:c,isTweetifyVisible:f,setHoveringTimestamp:j,summarizedTitle:u,summaryData:x,summaryState:H}=t,{t:k}=te(),[m,y]=s.useState(!1),q=Re.getQueryData(["sharedUserSettings"]),L=()=>{const b=Ht({summarizedTitle:u,summaryData:x},q);window.parent.postMessage({data:{context:b},type:it.YOUTUBE_SUMMARY},"*")};function F(b){const S=b;document.getElementsByTagName("video")[0].currentTime=Number(S),B({eventName:"SeekVideo",eventType:"Button",feature:"YoutubeSummaryContainer",firedFromFile:"content-migrated/youtubeSummary/YoutubeSummaryContainer"})}return e.jsx(X,{children:H===n.SUCCESS&&!c&&e.jsxs(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-medium",children:u.replaceAll('"',"")}),e.jsxs("div",{className:"flex items-center justify-between gap-6 border-b pb-[14px] pt-3 dark:border-zinc-800",children:[e.jsx("button",{className:"border-cornblue-600 dark:bg-background flex h-[30px] translate-x-[1.5px] items-center justify-center gap-2 rounded-[4px] border bg-zinc-50 p-2 py-1 text-sm",type:"button",onClick:L,children:k("yt_lib.chat_with_summ")}),e.jsxs("button",{className:"flex items-center justify-center gap-1 text-sm",type:"button",onClick:()=>{y(b=>!b)},children:[e.jsxs("span",{className:"font-hanken text-zinc-400 underline",children:[k(m?"yt_lib.collapse":"yt_lib.expand")," ",k("yt_lib.summ")]}),e.jsx("span",{className:G("transition-all duration-200",m?"-rotate-180":""),children:e.jsx(pt,{className:"stroke-zinc-400",size:14})})]})]}),x.map((b,S)=>{const v=Math.floor(Number(b.timeStamp)/3600),g=Math.floor(Number(b.timeStamp)%3600/60),h=Math.floor(Number(b.timeStamp)%3600%60);return e.jsx("div",{className:"mt-2 flex flex-col gap-2 [border-style:solid] dark:border-t-zinc-700",onMouseEnter:()=>{m||j(S)},onMouseLeave:()=>{m||j(null)},children:e.jsxs("div",{className:G("flex flex-col gap-1 rounded-lg p-1 transition-colors  duration-300",{" border-zinc-200 bg-zinc-100 dark:border-zinc-700 dark:bg-zinc-800  ":S===a||S===i}),children:[e.jsxs("div",{className:"flex justify-between gap-2 rounded-lg text-base",children:[e.jsx("div",{children:"âœ¦"}),e.jsxs("div",{className:"flex flex-1 flex-col gap-1",children:[e.jsx("div",{children:b.content}),!m&&e.jsx(X,{children:b.explaination&&(a===S||S===i)&&b.explaination.length>0&&e.jsxs(M.div,{initial:{height:0,opacity:0,y:-5},animate:{height:"auto",opacity:1,y:0},exit:{height:0,opacity:0,y:-5},transition:{duration:.05},className:"mb-1 flex w-fit cursor-pointer items-center justify-between gap-2 text-sm text-zinc-400",onClick:()=>{B({eventName:i?"ToggleCollapse":"ToggleExpand",eventType:"Button",feature:"YTSummaryExplanation",firedFromFile:"content-migrated/youtubeSummary/YoutubeSummaryContainer"}),r(S)},children:[e.jsxs("div",{children:[" ","Click to",S===i?" collapse":" expand"]}),e.jsx("div",{className:"h-3 w-3",children:S===i?e.jsx($e,{}):e.jsx(Pe,{})})]})})]}),e.jsxs("div",{className:"mt-1 h-fit w-fit cursor-pointer rounded bg-fuchsia-200 px-2 py-1 text-sm font-medium text-fuchsia-800 dark:bg-zinc-700 dark:text-zinc-100",onClick:()=>F(b.timeStamp),children:[v>0&&`${v}:`,g<10?`0${g}`:g,":",h<10?`0${h}`:h]})]}),e.jsx(X,{children:(S===i||m)&&e.jsx(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1,transition:{opacity:{duration:.4}}},exit:{height:0,opacity:0,transition:{opacity:{duration:.1}}},transition:{duration:.3},className:"pl-5",children:e.jsx(e.Fragment,{children:e.jsx("div",{className:"border-l border-l-zinc-200 [border-style:solid] dark:border-l-zinc-700 ",children:e.jsx("div",{className:"ml-1 rounded-lg text-sm",children:e.jsx("ul",{className:"list-outside  list-disc pl-5",children:b.explaination.map((p,W)=>e.jsx("li",{children:p},W))})})})})})})]})},S)})]}),e.jsx("div",{className:G("dark:bg-background sticky bottom-0 flex w-full flex-col items-center justify-center gap-2 bg-zinc-50 pt-2",!f&&"pb-3"),children:e.jsx(or,{summaryData:x})})]})})},lr=({handleSummarize:t,isTweetifyVisible:r,setTryAgainAfterLogin:i,summaryData:a,summaryTitle:c,tooltipString:f})=>{const{t:j}=te(),{...u}=s.useContext(me);return s.useEffect(()=>{ct({page_location:"/youtubeSummary/YoutubeSummaryGlimpse",page_title:"YT Summary Glimpse Container",window_type:"page"})},[]),e.jsx(X,{children:e.jsxs(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},children:[e.jsxs("div",{className:"px-[12px] py-[8px]",children:[e.jsx("h1",{className:"text-lg font-medium",children:c.replaceAll('"',"")}),a.map((x,H)=>{const k=Math.floor(Number(x.timeStamp)/3600),m=Math.floor(Number(x.timeStamp)%3600/60),y=Math.floor(Number(x.timeStamp)%3600%60);return e.jsx("div",{className:"mt-2 flex flex-col gap-2 dark:border-t-zinc-700",children:e.jsx("div",{children:e.jsxs("div",{className:"flex justify-between gap-2 rounded-lg text-base",children:[e.jsx("div",{children:"âœ¦"}),e.jsx("div",{className:"flex flex-1 flex-col gap-1",children:e.jsx("div",{children:x.content})}),e.jsxs("div",{className:"mt-1 h-fit w-fit rounded bg-fuchsia-200 px-2 py-1 text-sm font-medium text-fuchsia-800 dark:bg-zinc-700 dark:text-zinc-100",children:[k>0&&`${k}:`,m<10?`0${m}`:m,":",y<10?`0${y}`:y]})]})})},H)})]}),e.jsx("div",{className:G("absolute flex w-full flex-col items-center justify-center gap-2 rounded-b-2xl bg-gradient-to-t from-zinc-100 from-40% p-4 pt-[7rem] dark:from-zinc-900",r&&"bottom-[65px]",!r&&"bottom-[5px]"),children:e.jsx("div",{className:"bg-cornblue-600 relative cursor-pointer rounded-[4px] hover:bg-left-top",onClick:()=>{u.isAuthenticated?(B({eventName:"YoutubeSummarizeButton",eventType:"Button",feature:"YoutubeSummaryGlimpse",firedFromFile:"content-migrated/youtubeSummary/YoutubeSummaryContainer"}),t()):(B({eventName:"YoutubeGlimpseLoginTriggerCTA",eventType:"Button",feature:"YoutubeSummaryGlimpse",firedFromFile:"content-migrated/youtubeSummary/YoutubeSummaryContainer"}),ge(He),i(x=>x+1))},children:e.jsx("div",{className:"group relative flex items-center gap-2 px-4 py-2 font-sans text-sm font-semibold text-zinc-50",children:e.jsx(X,{children:e.jsxs(M.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[u.isAuthenticated?j("yt_header.summ_vid"):j("yt_header.login_summ"),e.jsx(Be,{position:"top",children:f})]})})})})})]})})};function xt(t){const{color:r,value:i}=t,a=100,c=0,f=i>a?a:i<c?c:i;return e.jsx("div",{className:t.className,children:e.jsx("div",{className:"flex h-[3px] w-full overflow-hidden rounded-lg bg-zinc-300 text-xs",children:e.jsx("div",{className:"h-[3px] rounded-lg transition-[width] duration-500 ease-in-out",style:{backgroundColor:r,backgroundImage:`repeating-linear-gradient(
                -45deg,
                rgba(255, 255, 255, 0.15),
                rgba(255, 255, 255, 0.15) 2px,
                transparent 2px,
                transparent 4px
              )`,width:`${f}%`}})})})}xt.defaultProps={className:"w-full"};const ur=t=>{const{t:r}=te(),{...i}=s.useContext(me),[a,c]=s.useState(!1),[f,j]=s.useState(!1),{actualVideoTitle:u,adsState:x,captionState:H,handleGetTranscript:k,handleSummarize:m,isSummaryCollapsed:y,loaderDesc:q,queryCost:L,regenerateSummary:F,setIsSummaryCollapsed:b,summarizedTitle:S,summaryData:v,summaryProgressValue:g,summaryState:h,transcriptData:p}=t,W=()=>{ge(He)},ee=()=>{B({eventName:y?"ToggleExpand":"ToggleCollapse",eventType:"Button",feature:"YoutubeSummary",firedFromFile:"content-migrated/youtubeSummary/YoutubeSummaryContainer"}),b(!y)},ne=s.useRef(null);Qt(ne,s.useCallback(()=>c(!1),[]));function E(Q,I){return`[${_t(Q)}](https://www.youtube.com/watch?v=${I}&t=${Math.floor(Number(Q))})`}const N=Q=>{const I=ke();let P="";const _=v.map(w=>`${E(w.timeStamp,I)} ${w.content}`).join(`

`),re=v.map(w=>`- ${w.content}`).join(`

`);switch(Q){case 0:{P=_;break}case 2:{const w=v.map(z=>`${z.content}
${z.explaination.map(V=>`- ${V}`).join(`
`)}`).join(`

`);P=`Short Summary for [${u}](https://www.youtube.com/watch?v=${I}) by [Merlin](https://merlin.foyer.work/)

${S}

${re}

---------------------------------

Detailed Summary for [${u}](https://www.youtube.com/watch?v=${I}) by [Merlin](https://merlin.foyer.work/)

${S}

${w}`;break}case 1:{const w=v.map(z=>`${E(z.timeStamp,I)} ${z.content}
${z.explaination.map(V=>`- ${V}`).join(`
`)}`).join(`

`);P=`Short Summary for [${u}](https://www.youtube.com/watch?v=${I}) by [Merlin](https://merlin.foyer.work/)

${S}

${_}

---------------------------------

Detailed Summary for [${u}](https://www.youtube.com/watch?v=${I}) by [Merlin](https://merlin.foyer.work/)

${S}

${w}`;break}case 5:{let w=`Transcript for [${u}](https://www.youtube.com/watch?v=${I}) by [Merlin](https://merlin.foyer.work/)

`;p.map(z=>{w+=` ${z.timestamp.start} - ${z.timestamp.end} ${z.text}`}),P=w;break}case 4:{let w=`Transcript for [${u}](https://www.youtube.com/watch?v=${I}) by [Merlin](https://merlin.foyer.work/)

`;p.map(z=>{w+=z.text}),P=w;break}}navigator.clipboard.writeText(P).then(()=>{j(!0),c(!1),setTimeout(()=>{j(!1)},2e3)}).catch(w=>{console.error("Async: Could not copy text: ",w)}),B({eventName:"CopyButton",eventType:"Button",feature:"YoutubeSummaryContainer",firedFromFile:"content-migrated/youtubeSummary/YoutubeSummaryContainer"})},J=()=>e.jsx(X,{children:a&&e.jsx(M.div,{className:"absolute left-1/2 flex h-fit w-32 -translate-x-1/2 translate-y-full flex-col rounded-[4px] border border-zinc-200 bg-zinc-100 text-sm text-zinc-800 dark:border dark:border-zinc-600 dark:bg-zinc-800 dark:text-zinc-200",initial:{bottom:-15,opacity:0},animate:{bottom:-5,opacity:1,transition:{damping:20,stiffness:500,type:"spring"}},exit:{opacity:0,transition:{delay:.1}},children:h===n.SUCCESS?e.jsxs("div",{className:"flex flex-col ",children:[e.jsx("span",{onClick:()=>N(1),className:"cursor-pointer p-2 first:border-b first:border-b-zinc-200 dark:first:border-b-zinc-400",children:r("yt_header.copy_all")}),e.jsx("span",{onClick:()=>N(2),className:"cursor-pointer p-2 first:border-b first:border-b-zinc-400 dark:first:border-b-gray-100",children:r("yt_header.copy_without_timestamps")}),e.jsx("span",{onClick:()=>N(0),className:"cursor-pointer p-2 first:border-b first:border-b-zinc-400 dark:first:border-b-gray-100",children:r("yt_header.copy_all_main")})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{onClick:()=>N(5),className:"cursor-pointer p-2 first:border-b first:border-b-zinc-200 dark:first:border-b-zinc-400",children:r("yt_header.copy_with_timestamps")}),e.jsx("span",{onClick:()=>N(4),className:"cursor-pointer p-2 first:border-b first:border-b-zinc-200 dark:first:border-b-zinc-400",children:r("yt_header.copy_without_timestamps")})]})})});return e.jsxs("div",{className:"relative flex min-h-[56px] flex-col justify-center",children:[e.jsxs("div",{className:G("z-10 flex items-center justify-between px-3 py-2",{"border-b border-b-zinc-200 [border-style:solid] dark:border-b-zinc-700":!y&&i.isAuthenticated,"pb-[5px]":h===n.LOADING&&i.isAuthenticated}),children:[e.jsxs("div",{className:"flex items-center gap-2 py-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(qt,{})}),i.isAuthenticated&&e.jsxs("div",{children:[" ",e.jsx(Wt,{usageDetails:i.usageDetails})," "]})]}),!i.isLoading&&(!i.isAuthenticated||i.isAuthenticated&&y&&(h===n.SUCCESS||h===n.ERROR))&&e.jsx("div",{className:"text-sm font-medium xl:text-base dark:text-zinc-50",children:r("yt_header.yt_summ")})]}),i.isAuthenticated?e.jsx(e.Fragment,{children:h===n.SUCCESS||h===n.TRANSCRIPT&&p.length>0?e.jsxs("div",{className:"flex items-center gap-2",children:[!y&&e.jsxs(e.Fragment,{children:[e.jsx(X,{children:f&&e.jsx(M.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},transition:{duration:.1},className:"text-sm text-green-700 dark:text-green-500",children:r("yt_header.copied")})}),e.jsxs("div",{ref:ne,className:"relative mr-[4px] flex",children:[e.jsx("button",{type:"button",className:"group relative cursor-pointer rounded-[4px] border border-zinc-500",children:e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx("span",{onClick:()=>{h===n.TRANSCRIPT?N(4):N(1)},className:"border-r border-zinc-500 p-[3px]",children:e.jsx(Vt,{size:18,strokeWidth:1.5})}),e.jsx("span",{onClick:()=>c(Q=>!Q),className:G("p-[3px] transition-all duration-200",{"rotate-180":a}),children:e.jsx(pt,{size:18,strokeWidth:1.5})})]})}),J()]}),e.jsx("div",{children:e.jsxs("div",{className:"group relative cursor-pointer rounded-lg",onClick:()=>{h===n.SUCCESS?F():h===n.TRANSCRIPT&&k(),B({eventName:"RegenerateButton",eventType:"Button",feature:"YoutubeSummaryContainer",firedFromFile:"content-migrated/youtubeSummary/YoutubeSummaryContainer"})},children:[e.jsx(dt,{size:20,strokeWidth:1.5}),e.jsxs(Be,{position:"top",children:[r("yt_header.regen")," ",h===n.SUCCESS?"Summary":h===n.TRANSCRIPT?"Transcript":""]})]})})]}),e.jsx(Ye,{position:"top-[62px] right-[10px]",source:"ytSummarizer"}),e.jsx("div",{className:"cursor-pointer rounded-lg bg-zinc-200 p-1 dark:bg-zinc-700",onClick:ee,children:e.jsx("div",{className:"h-5 w-5",children:y?e.jsx(Pe,{}):e.jsx($e,{})})})]}):e.jsx(e.Fragment,{children:h!==n.ERROR&&h!==n.GLIMPSE||y&&h===n.GLIMPSE||h===n.TRANSCRIPT&&v.length<=2?e.jsxs("div",{className:"flex items-center",children:[v.length<=2&&e.jsx("div",{className:"bg-cornblue-600 relative cursor-pointer rounded-[4px] hover:bg-left-top",onClick:()=>{x||(m(),B({eventName:"YoutubeSummarizeButton",eventType:"Button",feature:"YoutubeSummaryContainer",firedFromFile:"content-migrated/youtubeSummary/YoutubeSummaryContainer"}))},children:e.jsx("div",{className:"group relative flex items-center gap-2 px-4 py-2 font-sans text-sm font-semibold text-zinc-50",children:e.jsx(X,{children:h===n.LOADING?e.jsxs(M.div,{className:"flex items-end gap-2",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[e.jsxs("div",{children:[q," "]}),e.jsx(rt,{})]}):e.jsxs(M.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[r("yt_header.summ_vid"),e.jsx(Be,{position:"top",children:x?r("yt_lib.wait_ad"):`${r("yt_lib.will_use")} ${L??4} ${de(i.usageDetails.type)?r("yt_lib.words"):r("yt_lib.free_summ")}`})]})})})}),e.jsx(Ye,{position:"top-[62px] right-[14px]",source:"ytSummarizer"})]}):e.jsxs("div",{className:"flex items-center",children:[h===n.GLIMPSE&&e.jsx(Ye,{position:"top-[62px] right-[14px]",source:"ytSummarizer"}),e.jsx("div",{className:"cursor-pointer rounded-lg bg-zinc-200 p-1 dark:bg-zinc-700",onClick:ee,children:e.jsx("div",{className:"h-5 w-5",children:y?e.jsx(Pe,{}):e.jsx($e,{})})})]})})}):e.jsx("div",{className:"center-with-flex bg-cornblue-600 group relative cursor-pointer gap-2 rounded-[4px] border-[0px] px-4 py-2 font-sans",children:e.jsx("div",{className:"flex items-center gap-2 font-sans text-sm font-semibold text-zinc-50",children:i.isLoading?e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{children:[r("yt_header.logging")," "]}),e.jsx(rt,{})]}):e.jsx("div",{onClick:W,children:r("yt_header.login")})})})]}),h===n.LOADING&&i.isAuthenticated&&e.jsx("div",{className:"absolute flex min-h-[56px] w-full flex-col justify-end overflow-hidden rounded-t-2xl border border-zinc-200 [border-style:solid] dark:border-zinc-700 dark:text-zinc-200",children:e.jsx(xt,{color:"#34D399",value:g})})]})},dr=({adsState:t,askConfirmState:r,batches:i,captionState:a,changeConfirmState:c,errorMessage:f,errorType:j=se.UNKNOWN_ERROR,handleGetTranscript:u,isSummaryCollapsed:x,isTranscriptLoading:H,isTweetifyVisible:k,onClick:m,queryCost:y,regenerateSummary:q,requestIdHeader:L,setIsSummaryCollapsed:F,setSummaryState:b,setTryAgainAfterLogin:S,summarizedTitle:v,summaryData:g,summaryProgressValue:h,summaryState:p,transcriptData:W,transcriptError:ee,urlChange:ne})=>{var we;const{t:E}=te(),{...N}=s.useContext(me),J=C.useRef(N.token),[Q,I]=C.useState(0),[P,_]=C.useState(11),[re,w]=C.useState(0),[z,V]=s.useState(!1),[be,Se]=C.useState(!1),[_e,ve]=C.useState(null),[pe,K]=C.useState(null),ie=((we=document.querySelector("h1.title.style-scope.ytd-video-primary-info-renderer"))==null?void 0:we.textContent)||v,[Ie,ze]=C.useState(!1),[qe,Ae]=C.useState(!1),[Me,Ne]=C.useState(!1),ae=ft(p),[Oe,fe]=s.useState("Creating Summary");function De(R){K(R===pe?null:R)}const oe=s.useCallback(async(R=!1)=>{try{p!==n.LOADING&&await m("SIDE",!1,R),Ne(!0)}catch{}},[p,m]);function je(R){const Y=R;document.getElementsByTagName("video")[0].currentTime=Number(Y),B({eventName:"SeekVideo",eventType:"Button",feature:"YoutubeSummaryContainer",firedFromFile:"content-migrated/youtubeSummary/YoutubeSummaryContainer"})}s.useEffect(()=>{p===n.SUCCESS&&ct({page_location:"/youtubeSummary/YoutubeSummaryContainer",page_title:"YT Summary Container",window_type:"page"})},[p]),C.useEffect(()=>{I(N.usageDetails.used),_(N.usageDetails.limit),w(P-Q)},[N.usageDetails,i.length,P,Q]),C.useEffect(()=>{J.current=N.token},[N.token]);function Ue(){b(n.DEFAULT),Se(!1),V(!1),F(!0),ve(null),K(null),Ae(!1)}return s.useEffect(()=>{(ae===n.LOADING||!ae)&&(p===n.SUCCESS||p===n.ERROR)&&(Se(!1),V(!1),F(!1))},[p,a]),C.useEffect(()=>{Ue()},[ne]),s.useEffect(()=>{if(a.current===A.NOT_FOUND){const R=[E("yt_lib.downloading"),E("yt_lib.transcribing"),E("yt_lib.summarizing")];h<40?fe(R[0]):h<80?fe(R[1]):fe(R[2])}},[h,a]),e.jsxs("div",{className:"dark:bg-background mb-6 rounded-2xl border border-zinc-200 bg-zinc-50 [border-style:solid] dark:border-zinc-700 dark:text-zinc-200 overflow-hidden",children:[e.jsxs("div",{className:"relative mb-3 flex-1",children:[r[0]&&r[1]==="MID"&&e.jsx("div",{className:"animate-ping-youtube absolute -z-10 h-full w-full rounded-2xl border-[3px] border-red-500 [border-style:solid] dark:border-red-500"}),!r[0]&&e.jsx(ur,{adsState:t,actualVideoTitle:ie,captionState:a,copiedSummary:Ie,summaryData:g,summarizedTitle:v,handleSummarize:oe,isB2bUser:de,isSummaryCollapsed:x,loaderDesc:Oe,queryCost:y,regenerateSummary:q,summaryProgressValue:h,summaryState:p,setIsSummaryCollapsed:F,transcriptData:W,handleGetTranscript:u}),(p===n.GLIMPSE||p===n.SUCCESS||p===n.LOADING||!x||p===n.TRANSCRIPT)&&e.jsxs("div",{className:"flex w-full justify-center",children:[e.jsxs("button",{type:"button",className:G("flex w-full items-center justify-center gap-1 px-4 py-2 transition-colors duration-200",p!==n.TRANSCRIPT?"bg-zinc-200 text-zinc-900 dark:bg-zinc-700 dark:text-white":"bg-zinc-100 text-zinc-400 dark:bg-zinc-800"),onClick:()=>{b(Me?n.SUCCESS:n.GLIMPSE)},children:[" ",e.jsx(Xt,{})," ",E("yt_lib.summarize")]}),e.jsxs("button",{type:"button",className:G("flex w-full items-center justify-center gap-1 px-4 py-2 transition-colors duration-200",p===n.TRANSCRIPT?"bg-zinc-200 text-zinc-900 dark:bg-zinc-700 dark:text-white":"bg-zinc-100 text-zinc-400 dark:bg-zinc-800"),onClick:()=>{b(n.TRANSCRIPT)},children:[" ",e.jsx(st,{})," ",E("yt_lib.transcript")]})]}),e.jsxs(M.div,{id:"merlin-captions",className:G("merlinExt-custom-scrollbar scrollbar-w-1 max-h-[70vh] overflow-y-auto overflow-x-hidden transition-all dark:text-zinc-100"),initial:{padding:!x&&p===n.SUCCESS?"8px 12px 0 12px":""},animate:{padding:!x&&p===n.SUCCESS?"8px 12px 0 12px":""},transition:{delay:.3},children:[p===n.TRANSCRIPT?e.jsx("div",{className:"flex w-full items-center justify-center",children:H?e.jsx("div",{className:"merlinExt-circular-loader m-6"}):ee.length>0?e.jsx("div",{className:"my-4 flex items-center justify-center gap-2 ",children:ee==="WHISPER_ERROR"?e.jsx(nt,{queryCost:y,handleSummarize:()=>u(!0),setIsSummaryCollapsed:F,changeConfirmState:c}):e.jsxs("div",{className:"flex w-[93%] items-center justify-center gap-2 text-rose-500",children:[e.jsx(Ut,{}),ee]})}):e.jsx("div",{className:" max-h-[70%] w-[93%] py-2",children:W.map((R,Y)=>e.jsx("button",{className:G(" text-start ",R.active?"text-zinc-900 dark:text-zinc-100":"text-zinc-500"),id:R.active?"merlin-caption-active":"non-active",onClick:()=>je(R.timestamp.start),type:"button",children:R.text},Y))})}):p===n.GLIMPSE&&(!x||!N.isAuthenticated)?e.jsx(lr,{setTryAgainAfterLogin:S,isTweetifyVisible:k,summaryTitle:v,summaryData:g,handleSummarize:oe,tooltipString:t?E("yt_lib.wait_ad"):`${E("yt_lib.will_use")} ${y??4} ${de(N.usageDetails.type)?E("yt_lib.words1"):E("yt_lib.queries")}`}):e.jsx(cr,{summaryState:p,isSummaryCollapsed:x,summarizedTitle:v,summaryData:g,setHoveringTimestamp:ve,hoveringTimestamp:_e,expandedTimestamp:pe,changeExpandedTimestamp:De,isTweetifyVisible:k}),e.jsx(X,{children:!x&&e.jsx(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1,transition:{duration:.1}},exit:{height:0,opacity:0},transition:{duration:.3},children:e.jsx(ar,{UI_STATES:n,authDetails:N,errorType:j,summaryState:p,errorMessage:f})})})]}),r[0]&&a.current===A.NOT_FOUND&&e.jsx(nt,{queryCost:y,handleSummarize:oe,setIsSummaryCollapsed:F,changeConfirmState:c}),(W.length===0||p===n.GLIMPSE)&&e.jsx("div",{className:"mt-2 flex w-full items-center justify-center",children:e.jsxs("button",{type:"button",className:" border-cornblue-600 flex w-[93%] items-center justify-center gap-2 rounded border px-6 py-2",onClick:()=>{u(),b(n.TRANSCRIPT)},children:[e.jsx(st,{}),E(H?"yt_lib.getting_ts":"yt_lib.get_ts")]})}),k&&e.jsx(ir,{queryCost:y})]}),p===n.SUCCESS&&e.jsx("div",{className:"m-2 flex items-center justify-center",children:e.jsx(Bt,{queryTerms:JSON.stringify({feature:"YT_SUMMARY",href:window.location.href}),promptResult:JSON.stringify(g),callingSite:window.location.href,email:!N.email||N.email===""?"EMAIL_NOT_FOUND":N.email,requestId:L})}),e.jsx(Yt,{feature:"youtubeSummarizer",fileName:"features/youtubeSummarizer"})]})},mr=()=>{var Qe,Ve;const{...t}=s.useContext(me),[r,i]=s.useState(!1),{getYoutubeSummary:a}=Ze(rr,"getYoutubeSummary",!1),{getYoutubeSummaryGlimpse:c}=Ze(sr,"getYoutubeSummaryGlimpse",!1),[f,j]=s.useState([]),[u,x]=C.useState(null);C.useRef(!1);const[H,k]=s.useState(0),[m,y]=s.useState(0),q=s.useDeferredValue(m),[L,F]=C.useState([]),[b,S]=s.useState([]),[v,g]=C.useState(n.DEFAULT),h=C.useRef(new AbortController),[p,W]=s.useState(""),ee=tr(),[ne,E]=s.useState(!1),[N,J]=s.useState(10),[Q,I]=s.useState(!1),P=C.useRef(new AbortController),_=s.useRef(A.UNKNOWN),re=s.useRef(xe.UNKNOWN),w=s.useRef(!0),[z,V]=C.useState(_.current!==A.NOT_FOUND),[be,Se]=s.useState(!0),[_e,ve]=s.useState(!1),[pe,K]=s.useState([!1,""]),[ie,Ie]=s.useState(null),[ze,qe]=s.useState(null),[Ae,Me]=s.useState(!1),[Ne,ae]=s.useState(0),[Oe,fe]=s.useState(0),De=It(),[oe,je]=s.useState(0),[Ue,we]=s.useState(null),R=()=>{const o=Mt();Se(o)};s.useEffect(()=>{let o="";const l=O=>{location.href!=o&&(o=location.href,k(D=>D+1),y(D=>D+1))},d=O=>{l()},T=new MutationObserver(d);return T.observe(document.documentElement,{childList:!0,subtree:!0}),()=>{T.disconnect()}},[]);const Y=s.useCallback(async()=>{var T;const o=(T=document.querySelector("span.ytp-time-duration"))==null?void 0:T.textContent,l=await zt(o,_.current,de(t.usageDetails.type)),d=await At(o,l,de(t.usageDetails.type));Ie(l),qe(d)},[t]),We=kt(Y,300);s.useEffect(()=>{let o;Y();const l=document.querySelector("span.ytp-time-duration"),d=T=>{We()};return l&&(o=new MutationObserver(d),o.observe(l,{characterData:!0,childList:!0,subtree:!0})),()=>{o&&o.disconnect()}},[We,Y]),s.useEffect(()=>{let o;const l=document.getElementsByClassName("video-ads ytp-ad-module")[0];R();const d=()=>{R()};return l&&(o=new MutationObserver(d),o.observe(l,{characterData:!0,childList:!0,subtree:!0})),()=>{o&&o.disconnect()}},[]);async function ce(){x(n.LOADING),j([]),F([]),h.current.abort(),re.current,xe.UNKNOWN,ae(0),x(n.DEFAULT),J(10),I(!1),K([!1,""])}s.useEffect(()=>{!t.isLoading&&t.isAuthenticated&&t.token&&!ee&&ne&&r&&(i(!1),Ee()),t.isAuthenticated||ae(0)},[t.token,t.isLoading,t.isAuthenticated]),s.useEffect(()=>{w.current?(w.current=!1,x(n.SUCCESS)):(ce(),S([]),_.current!==A.UNKNOWN&&(_.current,A.UNKNOWN,Y())),ye({action:ue.RESET_HIGHLIGHTS_BUTTON,type:Z.FROM_YT_SUMMARIZER})},[m]),s.useEffect(()=>{(async()=>{var l;const o=await ot();o&&(o.summarizer.whisper.visible&&ve(!0),(l=o==null?void 0:o.tweetify)!=null&&l.visible&&Me(!0))})()},[]);const he=async(o,l=!1,d=!1)=>{!l&&L.length>0&&v===n.SUCCESS||(l&&await ce(),t.isAuthenticated?(!d&&o==="SIDE"&&(await ce(),await Ee(!l,o,d)),!d&&o==="MID"&&(await ce(),await Ee(!l,o,d)),d&&o==="SIDE"&&(pe[0]?(g(n.LOADING),E(!0),await ce(),K([!1,"SIDE"]),await Ee(!l,o,d)):(g(n.DEFAULT),E(!1),K([!0,"SIDE"])))):t.isLoading||St())},[yt,Te]=s.useState(!1),[gt,Le]=s.useState(""),bt=async(o=!1)=>{try{V(!1),Te(!0),S([]),Le("");const l=ke(),d=await nr(l,o);if(d.error||!d.captions){Te(!1),Le(d.error||"Something went wrong");return}const T=d.captions.split(/\b\d+\.\d+\s\d+\.\d+\b/g),O=d.captions.match(/\b\d+\.\d+\s\d+\.\d+\b/g),D=T.shift(),$=O.map(Ce=>{const le=Ce.split(" ");return{end:Number(le[1]),start:Number(le[0])}}),U=T.map((Ce,le)=>({active:$[le].start<=document.getElementsByTagName("video")[0].currentTime&&$[le].end>=document.getElementsByTagName("video")[0].currentTime,text:Ce,timestamp:$[le]}));S(U),Te(!1)}catch{Te(!1),Le("Something went wrong! Please try again later.")}};s.useEffect(()=>{setInterval(()=>{var d,T,O,D;S($=>$.map((U,Ce)=>({...U,active:U.timestamp.start<=document.getElementsByTagName("video")[0].currentTime&&U.timestamp.end>=document.getElementsByTagName("video")[0].currentTime})));const o=(T=(d=document.getElementById("merlin-yt-summarizer"))==null?void 0:d.shadowRoot)==null?void 0:T.querySelector("#merlin-captions"),l=(D=(O=document.getElementById("merlin-yt-summarizer"))==null?void 0:O.shadowRoot)==null?void 0:D.querySelector("#merlin-caption-active");if(o&&l){const $=l.getBoundingClientRect();$.top>=0&&$.left>=0&&$.right<=window.innerWidth&&$.bottom<=window.innerHeight&&l.offsetTop-o.scrollTop>500&&o.scrollTo({behavior:"smooth",left:0,top:l.offsetTop-120})}},100)},[]);const St=()=>{ge(He)};s.useEffect(()=>{a.status==="error"?g(n.ERROR):a.status==="success"?g(n.SUCCESS):a.status==="idle"&&ce()},[a.status]);const Ee=async(o=!0,l="SIDE",d=!1)=>{const T=Xe(),O=setInterval(()=>{J(D=>D<80?D+10:(clearInterval(O),85))},T);try{g(n.LOADING),I(!0);const D=ke(),$=Lt();if(!D)return;const U=await a.execute(P.current.signal,D,ie,o,d,$);if(we(U.requestIdHeader),U.status==="warning"&&U.warning.type===A.NOT_FOUND&&l==="MID"){_.current=A.NOT_FOUND,await Y(),g(n.DEFAULT),E(!1),K([!0,"MID"]);return}if(U.status==="warning"&&U.warning.type===A.NOT_FOUND&&l==="SIDE"){_.current=A.NOT_FOUND,await Y(),g(n.DEFAULT),E(!1),K([!0,"SIDE"]);return}F(U.summary),W(U.title),g(n.SUCCESS),J(100),clearInterval(O),d&&re.current===xe.INITIATED&&Fe(U.summary)}catch{_.current=A.UNKNOWN,g(n.ERROR),clearInterval(O)}},vt=async()=>{g(n.DEFAULT),E(!0),await Nt()},Nt=async(o=!0)=>{const l=Xe(),d=setInterval(()=>{J(T=>T<80?T+10:(clearInterval(d),85))},l);try{I(!0);const T=ke();if(!T)return;const O=await c.execute(P.current.signal,T);F(O.summary),W(O.title),O.hasUserRequested?g(n.SUCCESS):g(n.GLIMPSE),V(!1),J(100),clearInterval(d)}catch{_.current=A.UNKNOWN,g(n.DEFAULT),clearInterval(d)}};s.useEffect(()=>{window.parent.postMessage({action:ue.UPDATE_COST_AND_ADS_STATE,context:{adsState:be,queryCost:ie,summaryState:v,tweetifyQueryCost:ze},type:Z.FROM_YT_SUMMARIZER},"*")},[be,ze,ie,Oe,v]),s.useEffect(()=>{q!==m&&vt()},[t.token,m]);const Fe=s.useCallback(o=>{ut(o,t.token,t.email),ye({action:ue.SET_HIGHLIGHTS_SUCCESS,type:Z.FROM_YT_SUMMARIZER})},[t.token,t.email]);return s.useEffect(()=>{Ne>0&&_.current!==A.NOT_FOUND&&u!==n.ERROR&&v===n.SUCCESS&&t.isAuthenticated&&Fe(L)},[L,Fe,Ne,u,v,t.isAuthenticated]),s.useEffect(()=>{re.current===xe.INITIATED&&(u===n.ERROR||v===n.ERROR)&&(ye({action:ue.RESET_HIGHLIGHTS_BUTTON,type:Z.FROM_YT_SUMMARIZER}),lt())},[u,v]),s.useEffect(()=>{const o=async l=>{if(l.data.type===Z.FROM_CHAT_UI&&l.data.action===Ot.NO_CAPTIONS_UPDATE_TRIGGER&&(_.current=A.NOT_FOUND,await Y()),l.data.type===Z.FROM_COMMENT_SECTION_HIGHLIGHTS_BUTTON)switch(l.data.action){case et.INITIATE_COMMENT_PROCESS:re.current=xe.INITIATED,await he("MID"),ae(d=>d+1);break;case et.GET_SHARED_STATE_ON_MOUNTING:fe(d=>d+1);break}if(l.data.type===Z.FROM_TWEETIFY_MID_BUTTONS)switch(l.data.action){case Dt.HANDLE_SUMMARIZE_FROM_MID_BUTTON:he("MID"),B({eventName:"YoutubeSummarizeMidButton",eventType:"Button",feature:"YoutubeSummarizer",firedFromFile:"src/features/youtubeSummarizer/YoutubeSummary"});break}};return window.addEventListener("message",o),()=>window.removeEventListener("message",o)},[Y]),er(ht.END),s.useEffect(()=>{oe&&t.isAuthenticated&&(he("SIDE"),je(0))},[oe,t.isAuthenticated]),_.current!==A.NOT_FOUND||_e?e.jsxs("div",{className:G("dark:bg-background rounded-2xl bg-zinc-50",De==="dark"&&"bg-background dark"),children:[u===n.LOADING&&e.jsx("div",{className:"dark:bg-background flex-1 overflow-hidden rounded-lg border border-zinc-200 bg-zinc-50 px-2 py-3 [border-style:solid] dark:border-zinc-700 dark:text-zinc-200",children:e.jsxs("span",{className:"flex flex-1 flex-col gap-2",children:[e.jsx("div",{className:"merlinExt-skeleton-loading-animate dark:merlinExt-skeleton-loading-animate-dark h-3 w-3/4 rounded"}),e.jsx("div",{className:"merlinExt-skeleton-loading-animate dark:merlinExt-skeleton-loading-animate-dark h-3 w-2/4 rounded"})]})}),u===n.DEFAULT&&e.jsx("div",{className:"flex-1",children:e.jsx(dr,{captionState:_,adsState:be,batches:f,onClick:he,summaryData:L,summaryState:v,setSummaryState:g,summarizedTitle:p,summaryProgressValue:N,urlChange:m,isSummaryCollapsed:z,setIsSummaryCollapsed:V,regenerateSummary:()=>he("SIDE",!0),askConfirmState:pe,changeConfirmState:K,queryCost:ie,isTweetifyVisible:Ae,transcriptData:b,handleGetTranscript:bt,isTranscriptLoading:yt,transcriptError:gt,errorType:(Qe=a.error)==null?void 0:Qe.type,errorMessage:(Ve=a.error)==null?void 0:Ve.message,setTryAgainAfterLogin:je,requestIdHeader:Ue})})]}):e.jsx(e.Fragment,{})},pr=()=>{const[t={ytSummarizer:{visible:!1}}]=Ct({instance:new Et({area:"local"}),key:"UserSettings"});return t.ytSummarizer.visible?e.jsx(Jt,{client:Re,persistOptions:{persister:Ft},children:e.jsx(Rt,{children:e.jsx(mr,{})})}):null};function fr(){return new Promise(t=>{const r=document.getElementById("page-manager"),i=new MutationObserver(()=>{const a=document.getElementById("secondary-inner");a&&(t(a),i.disconnect())});i.observe(r,{childList:!0,subtree:!0})})}const hr=async t=>{const r=document.createElement("merlin-component");r.id="merlin-yt-summarizer",r.className="merlin yt-summarizer";const i=r.attachShadow({mode:"open"}),a=document.createElement("style");a.textContent=`${Kt}
   :host(#merlin-yt-summarizer) {
    all: initial; /* 1st rule so subsequent properties are reset. */
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
.ytReactAppRoot {
    position: relative;
    z-index: 2000;
    font-family:
		"Hanken Grotesk",
		system-ui,
		-apple-system,
		BlinkMacSystemFont,
		Ubuntu,
		sans-serif !important;
}
`;const c=document.createElement("div");c.id="ytReactAppRoot",c.className="ytReactAppRoot",i.appendChild(a),i.appendChild(c),t(r),jt(c).render(e.jsx(pr,{}))},xr=async()=>{if(document.getElementById("merlin-yt-summarizer"))return;const t=await ot();if(!(t&&!t.summarizer.youtube.visible)&&(await fr(),document.body)){const r=new MutationObserver(()=>{const a=document.querySelectorAll("#secondary-inner");if(a.length>0)for(let c=0;c<a.length;c++)a[c].querySelector("merlin-component")||(hr(f=>a[c].prepend(f)),r.disconnect())}),i=document.querySelectorAll("#secondary-inner")[0];r.observe(i,{attributes:!0,childList:!0,subtree:!0})}};xr();
