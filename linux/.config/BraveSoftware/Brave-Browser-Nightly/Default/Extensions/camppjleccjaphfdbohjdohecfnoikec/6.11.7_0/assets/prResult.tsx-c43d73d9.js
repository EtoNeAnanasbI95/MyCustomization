import{r as p,j as t,c as E}from"./client-45b27fd3.js";import{L as y,g as C,i as A}from"./index-825701e8.js";import{C as T}from"./index-24d5af66.js";import{C as k}from"./index-e56b565e.js";import{R as M}from"./index-9b1f0f42.js";import{A as v}from"./index-39fb8d8a.js";import{m as u}from"./motion-2f15212b.js";import{I as N}from"./IconChevronRight-f54b4a77.js";import{u as P}from"./index-e31d72e6.js";import{A as D}from"./index-37dc4817.js";import{M as L}from"./messageContext-827c44b4.js";import{T as $}from"./themeContext-38ece4f9.js";import{c as q,a as F}from"./atom-one-light-7372aee1.js";import{c as H}from"./index-5c33a703.js";import"./utils-01642ffa.js";import"./analytics-46c41402.js";import"./IconCheck-740a5f2a.js";import"./createReactComponent-d14705e3.js";import"./IconCopy-3f3f64da.js";import"./hook-ae816606.js";import"./v4-4a60fe23.js";const O=({file:o})=>{var f,g,b,j;const l=window.location.origin,a=window.location.pathname.split("/");a.length===6&&a.pop();const n=`${l}${a.join("/")}.diff`,[i,s]=p.useState(!0),[e,m]=p.useState({}),[c,x]=p.useState([]),[h,z]=p.useState("");if(p.useEffect(()=>{y.get(`prSummarizer-${n}`).then(r=>{r&&m(r)}),window.addEventListener("message",r=>{r.data.type===M.PR_SUMMARIZER&&m(r.data.data)})},[n]),p.useEffect(()=>{(async()=>{if(!e.lastUpdated&&!e.summary&&!e.title)return;const r=Date.now(),{lastUpdated:d,summary:S,title:R}=e;if(r-d>2*60*1e3)return await y.remove(`prSummarizer-${n}`).then(()=>m({}));x(S??[]),z(R??"")})()},[e,n]),!!(c!=null&&c.length))return o==="title"&&h!==""?t.jsx(v,{children:t.jsx(u.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},transition:{duration:.2},className:"dark:bg-background relative z-20 flex cursor-pointer rounded-md border border-[#ddd] bg-zinc-100 px-2 py-2 text-zinc-900 shadow-sm transition-[min-height] duration-500 dark:border-zinc-700 dark:text-zinc-400",children:t.jsx(k,{content:h,syntaxHighlighting:!0})},"title")}):t.jsxs(t.Fragment,{children:[t.jsxs(u.div,{className:"dark:bg-background relative z-20 flex cursor-pointer bg-zinc-100 py-1 pl-[8px] shadow-sm transition-[min-height] duration-500 dark:border-zinc-700",onClick:()=>s(!i),children:[t.jsx(u.div,{className:"ml-[5px] flex items-center justify-between p-[5px]",children:t.jsx(u.div,{animate:i?{rotate:90}:{rotate:0},transition:{duration:.2},children:t.jsx(N,{className:"h-4 w-4 text-zinc-900 dark:text-zinc-400"})})}),t.jsx(u.div,{className:"flex items-center px-[3px] font-semibold text-zinc-900 dark:text-zinc-400",children:((g=(f=c.find(r=>{var d;return((d=r==null?void 0:r.data)==null?void 0:d.file)===o}))==null?void 0:f.data)==null?void 0:g.shortDescription)??"Summary not available"})]},"question"),t.jsx(v,{children:i&&t.jsx(u.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{collapsed:{height:0,opacity:0},open:{height:"auto",opacity:1}},transition:{duration:.4},className:"plain-text-color dark:bg-background relative  mx-auto w-full border-b border-l-0 border-r-0 border-t border-[#ddd]  bg-zinc-100 text-zinc-900 transition-[min-height] duration-500 dark:border-zinc-700 dark:text-zinc-400",children:t.jsx("div",{className:"p-2 px-4",children:t.jsx(k,{content:((j=(b=c.find(r=>{var d;return((d=r==null?void 0:r.data)==null?void 0:d.file)===o}))==null?void 0:b.data)==null?void 0:j.contentDetails)??"Summary not available",syntaxHighlighting:!0})})},o)})]})};function U({file:o}){const{blackList:l,codeSummarizer:a}=P();if(a&&!l.includes(window.location.hostname))return t.jsx(T,{children:t.jsx($,{children:t.jsx(D,{children:t.jsx(L,{children:t.jsx(O,{file:o})})})})})}const W=async()=>{const o=await C();if(o&&(!o.misc.codeSummarizer.visible||o.misc.codeSummarizer.blackListedDomains.includes(window.location.hostname)))return;(()=>{document.body&&new MutationObserver(A(()=>{var s;const n=document.querySelectorAll(".file-header.d-flex.flex-md-row.flex-column.flex-md-items-center.file-header--expandable.js-file-header.js-skip-tagsearch.sticky-file-header.js-position-sticky.js-position-sticky-stacked"),i=document.querySelector(".gh-header-meta");((s=i==null?void 0:i.nextElementSibling)==null?void 0:s.id)!=="merlin-pr-result"&&w(e=>{i==null||i.insertAdjacentElement("afterend",e)},"title"),n.forEach(e=>{var m,c;if(((m=e==null?void 0:e.nextElementSibling)==null?void 0:m.id)!=="merlin-pr-result"){const x=(c=e.querySelector(".Link--primary.Truncate-text"))==null?void 0:c.textContent;w(h=>{e==null||e.insertAdjacentElement("afterend",h)},x)}})},50)).observe(document.body,{attributes:!1,characterData:!1,childList:!0,subtree:!0})})()},w=async(o,l)=>{const a=document.createElement("merlin-component");a.id="merlin-pr-result",a.className="merlin-pr-result";const n=a.attachShadow({mode:"open"}),i=document.createElement("style");i.textContent=`${H}
:host(#merlin-pr-result) {
    all: initial; /* 1st rule so subsequent properties are reset. */
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}
.reactAppRoot{
    z-index: 1 !important;

}
.dark {
    ${q}
}
${F}
`;const s=document.createElement("div");s.id="reactAppRoot",s.className="reactAppRoot",n.appendChild(i),n.appendChild(s),o(a),E(s).render(t.jsx(U,{file:l}))};W();
