import{D as r,L as l,g as T}from"./index-825701e8.js";import{A as g}from"./index-9b1f0f42.js";function y(e){this.message=e}y.prototype=new Error,y.prototype.name="InvalidCharacterError";var h=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new y("'atob' failed: The string to be decoded is not correctly encoded.");for(var a,n,i=0,s=0,o="";n=t.charAt(s++);~n&&(a=i%4?64*a+n:n,i++%4)?o+=String.fromCharCode(255&a>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return o};function C(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(a){return decodeURIComponent(h(a).replace(/(.)/g,function(n,i){var s=i.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}(t)}catch{return h(t)}}function f(e){this.message=e}function N(e,t){if(typeof e!="string")throw new f("Invalid token specified");var a=(t=t||{}).header===!0?0:1;try{return JSON.parse(C(e.split(".")[a]))}catch(n){throw new f("Invalid token specified: "+n.message)}}f.prototype=new Error,f.prototype.name="InvalidTokenError";const D="https://www.google-analytics.com/mp/collect",O="https://www.google-analytics.com/debug/mp/collect",k="G-JZS898GQ18",F="9Sv1BQIYSX2647_jkbulrA",d=100,v=30,p=async()=>{let{clientId:e}=await r.storage.local.get("clientId");return e||(e=self.crypto.randomUUID(),await r.storage.local.set({clientId:e})),e},_=async()=>{let{sessionData:e}=await r.storage.local.get("sessionData");const t=Date.now();return e&&e.timestamp&&((t-e.timestamp)/6e4>v?e=null:(e.timestamp=t,await r.storage.local.set({sessionData:e}))),e||(e={session_id:t.toString(),timestamp:t.toString()},await r.storage.local.set({sessionData:e})),e.session_id},E=async()=>{var t,a;const e=await l.get("authDetails");if(e)return e.token?(a=(t=N(e==null?void 0:e.token))==null?void 0:t.details)==null?void 0:a.user_id:null};function A(e,t=500){const a=new Map;function n(i){return JSON.stringify(i.map(s=>typeof s=="object"?JSON.stringify(s):s))}return function(...i){const s=this,o=n(i),c=a.get(o);clearTimeout(c);const m=setTimeout(()=>{e.apply(s,i),a.delete(o)},t);a.set(o,m)}}const G=A(async e=>{const t=await T();if(t&&!t.ga4Config.active)return;const a=await l.get("installTimestamp"),n=await E();a&&n&&(r.runtime.sendMessage({action:g.ANALYTICS,payload:{client_id:await p(),events:[{name:"FirstInteraction",params:{engagement_time_msec:d,session_id:await _(),timestamp:Date.now(),user_id:n}}]}}),await l.remove("installTimestamp")),e.session_id&&(e.session_id=await _()),e.engagement_time_msec&&(e.engagement_time_msec=d);const{engagement_time_msec:i,eventData:s,eventName:o,eventType:c,feature:m,firedFromFile:u,session_id:w}=e,I={engagement_time_msec:i,eventData:s,eventType:c,feature:m,firedFromFile:u,session_id:w};try{r.runtime.sendMessage({action:g.ANALYTICS,payload:{client_id:await p(),events:[{name:o,params:I}]}})}catch(S){console.error(S)}}),L=A(async e=>{const t=await T();if(t&&!t.ga4Config.active)return;e.session_id&&(e.session_id=await _()),e.engagement_time_msec&&(e.engagement_time_msec=d);const{engagement_time_msec:a,page_location:n,page_title:i,session_id:s}=e,o={engagement_time_msec:a,page_location:n,page_title:i,session_id:s};try{r.runtime.sendMessage({action:g.ANALYTICS,payload:{client_id:await p(),events:[{name:"page_view",params:o}]}})}catch(c){console.error(c)}}),U=A(async e=>{const t=await T();if(t&&!t.ga4Config.active)return;const a=await l.get("installTimestamp"),n=await E();a&&n&&(r.runtime.sendMessage({action:g.ANALYTICS,payload:{client_id:await p(),events:[{name:"FirstInteraction",params:{engagement_time_msec:d,session_id:await _(),timestamp:Date.now(),user_id:n}}]}}),await l.remove("installTimestamp")),e.session_id&&(e.session_id=await _()),e.engagement_time_msec&&(e.engagement_time_msec=d);const{engagement_time_msec:i,feature:s,firedFromFile:o,prompt_text:c,prompt_type:m,session_id:u}=e,w={engagement_time_msec:i,feature:s,firedFromFile:o,prompt_text:c,prompt_type:m,session_id:u};try{r.runtime.sendMessage({action:g.ANALYTICS,payload:{client_id:await p(),events:[{name:s+m+"Prompt",params:w}]}})}catch(I){console.error(I)}});export{F as A,d as D,O as G,k as M,L as a,U as b,_ as c,E as d,D as e,G as f,p as g,N as o};
