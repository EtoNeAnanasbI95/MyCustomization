import{r as b,j as e,R as se,a as J,c as Y}from"./client-45b27fd3.js";import{c as Z,a as Te,i as be,g as Ye}from"./index-825701e8.js";import{u as Be}from"./usePopper-4d1ead05.js";import{C as ve}from"./index-24d5af66.js";import{F as ae}from"./foyerLogo-7f07d1ff.js";import{B as L}from"./button-f1c09d10.js";import{a as je,A as Se,b as Ke}from"./index-37dc4817.js";import{S as re,C as ke}from"./Combination-d7972bd9.js";import{M as Ge}from"./messageContext-827c44b4.js";import{T as we}from"./themeContext-38ece4f9.js";import{q as Ne,a as Ce,b as Ve,s as Je}from"./backend-b5a741e2.js";import{g as Fe,e as Xe,E as Ze,c as et,b as Ee,d as tt,f as ne}from"./index-9b1f0f42.js";import{L as $e}from"./hook-ae816606.js";import{S as H,I as st,T as Ie,a as Re,f as rt,l as at}from"./textarea-392328c1.js";import{B as fe,S as F}from"./skeleton-e68ed841.js";import{C as U,a as ee,b as Oe,c as nt,d as te}from"./card-16c0c2c1.js";import{o as ot,s as de,e as V,u as it,t as lt,F as ct,a as pe,b as he,c as ge,d as Le,I as De,f as Me,g as mt}from"./form-fccd3825.js";import{u as ut,a as dt}from"./useSharedUserSettings-04e5c292.js";import{f as _}from"./analytics-46c41402.js";import{u as pt}from"./useSSE-35954031.js";import{c as ht,A as gt,a as xt}from"./avatar-31868758.js";import{C as ft}from"./index-e56b565e.js";import{F as yt}from"./index-fa8b2430.js";import{u as oe}from"./useTranslation-c38a45bb.js";import{I as bt}from"./IconChevronUp-6396b04a.js";import{I as vt}from"./IconChevronDown-c0174c21.js";import{I as jt}from"./IconCheck-740a5f2a.js";import{I as St}from"./IconCopy-3f3f64da.js";import{I as wt}from"./IconRefresh-c267e433.js";import{I as Nt}from"./IconChevronLeft-dc942a4c.js";import{I as Ct}from"./IconChevronRight-f54b4a77.js";import{S as It,a as qt,b as At,c as Tt,d as _e}from"./select-70f68a35.js";import{I as xe}from"./IconX-71686591.js";import{I as ye}from"./IconSend-9aa4a715.js";import{c as Et}from"./createReactComponent-d14705e3.js";import{A as We}from"./index-39fb8d8a.js";import{m as X}from"./motion-2f15212b.js";import{v as Q}from"./v4-4a60fe23.js";import{P as qe,u as Rt}from"./PersistQueryClientProvider-53edff98.js";import{c as Pe}from"./utils-01642ffa.js";import{u as ze}from"./useUserSettings-c0487dc5.js";import{u as Lt}from"./useMutation-24b8df85.js";import{c as z}from"./index-5c33a703.js";/* empty css             */import"./index-cf2cbbfc.js";import"./index-9811e1a4.js";import"./useAsyncWithPromise-6dde1473.js";import"./index-203ce83a.js";import"./IconThumbUp-e2c311b9.js";import"./index-a24140fc.js";var Mt=Et("square","IconSquare",[["path",{d:"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}]]);const O=ht(s=>({quickPromptAIReply:"",setQuickPromptAIReply:n=>s({quickPromptAIReply:n}),toggleUsingAIComposeBtn:()=>s(n=>({usingAIComposeBtn:!n.usingAIComposeBtn})),usingAIComposeBtn:!1}));function _t({chat:s,handleInsert:n,handleRegenerateLastMessage:i,handleSSE:m,idx:h,isLastMessage:a,isSSESuccessOrIdle:r,mountOn:g,msg:d,requestIdHeader:j}){const{t:S}=oe(),[t,f]=b.useState(!1),{...u}=b.useContext(je);function A(C){navigator.clipboard.writeText(C),f(!0),setTimeout(()=>f(!1),1200)}const[p,E]=b.useState(!1);if(d.role=="user")return e.jsxs("div",{style:{zIndex:10+h},className:`${h===s.activeThread.length-2?"sticky top-0":""} bg-background mr-3`,id:"user-msg-container",children:[e.jsxs("div",{className:"flex items-start justify-between space-x-2 pl-2",id:`${h===s.activeThread.length-2?"user-msg-body":""}`,children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(fe,{className:"relative -left-1",variant:"secondary",children:S("super_gmail.prompt")}),e.jsx("span",{className:`text-foreground max-w-80 my-auto text-sm font-light transition-all duration-500 ease-in-out ${p?"":"line-clamp-1"}`,children:d.content})]}),d.content.length>52&&e.jsx("span",{onClick:()=>E(!p),className:"text-ds-icon-info w-24 cursor-pointer text-sm underline",children:p?e.jsx(bt,{size:18,color:"#9e9e9e",className:"ml-auto mr-4"}):e.jsx(vt,{size:18,color:"#9e9e9e",className:"ml-auto mr-4"})})]},d.id),e.jsx(H,{className:"my-2"})]});if(d.role==="assistant")return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex min-h-[262px] flex-grow flex-col justify-between px-2",children:[e.jsx(ft,{className:"!text-sm",content:d.content.trim()}),r&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 bg-white py-1 text-sm",children:[e.jsx(L,{className:"text-xs",onClick:()=>{_({eventName:"Insert",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/GMailMessage"}),n(s.activeThread[h].content)},children:S("super_gmail.insert")}),e.jsx("button",{type:"button",className:"bg-transparent p-1 only:rounded-md",onClick:()=>{A(d.content)},disabled:t,children:t?e.jsx(jt,{className:"plain-icon-color h-4 w-4 stroke-[1.5]"}):e.jsx(St,{className:"plain-icon-color h-4 w-4 stroke-[1.5]"})}),a&&e.jsx(wt,{className:"plain-icon-color h-4 w-4 cursor-pointer stroke-[1.5]",onClick:()=>{_({eventName:"Regenerate",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),i()}}),d.totSiblings>0&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{type:"button",className:" group/btn bg-transparent",onClick:()=>s.switchLeft(d),disabled:d.idx===0,children:e.jsx(Nt,{className:"plain-icon-color h-4 w-4 stroke-[1.5] group-disabled/btn:opacity-50"})}),e.jsxs("span",{className:"mx-0.5 flex items-end",children:[d.idx+1,e.jsx("span",{className:"relative -top-[1px]",children:"/"}),d.totSiblings]}),e.jsx("button",{type:"button",className:" group/btn bg-transparent",onClick:()=>s.switchRight(d),disabled:d.idx===d.totSiblings-1,children:e.jsx(Ct,{className:"plain-icon-color h-4 w-4 stroke-[1.5] group-disabled/btn:opacity-50"})})]}),a&&e.jsx("div",{className:"mr-auto",children:e.jsx(yt,{hideText:!0,queryTerms:JSON.stringify({feature:g,mountOn:g,query:s.activeThread[s.activeThread.length-2].content}),promptResult:s.activeThread[s.activeThread.length-1].content,callingSite:window.location.href,email:!u.email||u.email===""?"EMAIL_NOT_FOUND":u.email,requestId:j})})]})]}),e.jsx(H,{className:"my-2"})]});if(d.role==="system")return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex h-[262px] flex-col justify-between px-2",children:e.jsxs("div",{className:"",children:[e.jsx(F,{className:"mb-4 h-2 w-16"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(F,{className:"h-2 w-72"}),e.jsx(F,{className:"h-2 w-32"}),e.jsx(F,{className:"h-2 w-10"}),e.jsx(F,{className:"h-2 w-16"}),e.jsx(F,{className:"h-2 w-96"}),e.jsx(F,{className:"h-2 w-72"}),e.jsx(F,{className:"h-2 w-32"}),e.jsx(F,{className:"h-2 w-10"}),e.jsx(F,{className:"h-2 w-16"}),e.jsx(F,{className:"h-2 w-96"})]}),e.jsx(F,{className:"my-1 mt-4 h-2 w-16"}),e.jsx(F,{className:"h-2 w-20"})]})}),e.jsx(H,{className:"my-2"})]})}const Pt=ot({bio:de(),model:V(["GPT 3","GPT 4"]),name:de(),occupation:de(),outputLang:V(["english","hindi"]),outputLength:V(["short","medium","long"]),tone:V(["empathetic","optimistic","sincere","enthusiastic"]),writingStyle:V(["professional","casual","neutral"])});function Bt({setCurrentMode:s}){var g,d,j,S;const{t:n}=oe(),{...i}=b.useContext(je),[m,h]=$e({instance:new Fe({area:"local"}),key:"gmailPersona"},t=>t===void 0?{bio:"",model:`${i.usageDetails.type=="PAID"?"GPT 4":"GPT 3"}`,name:"",occupation:"",outputLang:"english",outputLength:"medium",tone:"empathetic",writingStyle:"professional"}:t),a=it({defaultValues:{bio:"",model:`${i.usageDetails.type=="PAID"?"GPT 4":"GPT 3"}`,name:"",occupation:"",outputLang:"english",outputLength:"medium",tone:"empathetic",writingStyle:"professional"},resolver:lt(Pt)});b.useEffect(()=>{a.reset(m)},[a,m]);function r(t){h(t),s("CHAT")}return e.jsx(U,{className:"relative mx-auto w-[502px] p-0 shadow-lg",children:e.jsxs(ee,{className:"flex p-0",children:[e.jsxs("div",{className:" -left-1 bottom-0 top-0 flex w-12 flex-col items-end justify-between gap-2 border-r p-1 py-2",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>{s("CHAT")},children:e.jsx(st,{})})}),e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>Z(Xe),children:e.jsx(gt,{className:"h-6 w-6",children:e.jsx(xt,{children:((j=(d=(g=i.name)==null?void 0:g.split(" "))==null?void 0:d.map(t=>t[0]))==null?void 0:j.join(""))??((S=i==null?void 0:i.email[0])==null?void 0:S.toUpperCase())??"U"})})})]}),e.jsxs("div",{className:"mt-3 w-full",children:[e.jsxs(re,{className:"h-[320px]",children:[e.jsx(Oe,{className:"p-3",children:e.jsx(nt,{className:"text-lg",children:n("super_gmail.config")})}),e.jsx(ct,{...a,children:e.jsx("form",{onSubmit:a.handleSubmit(r),children:e.jsxs("div",{className:"flex flex-col gap-2 p-3",children:[e.jsx("div",{className:"",children:e.jsx(pe,{control:a.control,name:"model",render:({field:t})=>e.jsxs(he,{children:[e.jsx(ge,{children:n("super_gmail.ai_model")}),e.jsxs(It,{onValueChange:t.onChange,value:t.value,children:[e.jsx(qt,{className:"w-96",children:e.jsx(At,{})}),e.jsxs(Tt,{children:[e.jsx(_e,{value:"GPT 3",children:"GPT 3"}),e.jsx(_e,{value:"GPT 4",children:"GPT 4"})]})]})]})})}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("h3",{className:"text-md font-semibold",children:n("super_gmail.persona")})}),e.jsx("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:e.jsx(pe,{control:a.control,name:"name",render:({field:t})=>e.jsxs(he,{children:[e.jsx(ge,{children:n("super_gmail.name")}),e.jsx(Le,{children:e.jsx(De,{placeholder:"Ashutosh Kumar",...t})}),e.jsx(Me,{})]})})}),e.jsx("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:e.jsx(pe,{control:a.control,name:"bio",render:({field:t})=>e.jsxs(he,{children:[e.jsx(ge,{children:n("super_gmail.bio")}),e.jsx(Le,{children:e.jsx(Ie,{placeholder:n("super_gmail.bio_placeholder"),className:"resize-none",...t})}),e.jsx(Me,{})]})})})]})})})]}),e.jsx(te,{className:"flex justify-end  gap-2 p-2 ",children:e.jsx(L,{onClick:a.handleSubmit(r),children:n("super_gmail.save")})})]})]})})}const kt=()=>{const{shadowRoot:s}=document.getElementById("merlin-gmail-uicomponentportal"),n=s.querySelector("[data-radix-scroll-area-viewport]");n&&setTimeout(()=>n.scrollTo({behavior:"smooth",left:0,top:n.scrollHeight}),100)};function Ae({handleInsert:s,id:n,mailThread:i=[],mountOn:m,setIsVisible:h}){var v;const{t:a}=oe(),{...r}=b.useContext(je),[g,d]=b.useState("CHAT"),[j,S]=b.useState(null),t=mt(),f=O(o=>o.quickPromptAIReply),u=O(o=>o.setQuickPromptAIReply),{sharedUserSettingsQuery:A}=ut(),[p,E]=b.useState(""),[C]=$e({instance:new Fe({area:"local"}),key:"gmailPersona"},o=>o===void 0?{bio:"",model:`${r.usageDetails.type=="PAID"?"GPT 4":"GPT 3"}`,name:"",occupation:"",outputLang:"english",outputLength:"medium",tone:"empathetic",writingStyle:"professional"}:o),[P,B]=b.useState(null),{handleGMailSSE:T}=pt(`${et.DOMAIN}/generative/gmail?&customJWT=true`,"handleGMailSSE",{method:"POST",onClose:()=>{t.editMessageNodeById(t.getLastMessage().id,o=>{var c;return o.status="SUCCESS",o.attachments=(c=o.attachments)==null?void 0:c.filter(N=>N.type==="IMAGE"&&N.url||N.type!=="IMAGE"),o}),t.setIsPromptingAvailable(!0)},onError:o=>{t.setIsPromptingAvailable(!0),console.error(o),t.deleteLastMessage(),(o==null?void 0:o.name)==="CUSTOM_ERROR"?o.type===Ze.RATE_LIMITED?t.setError(r.usageDetails.type==="PAID"?a("request_context.queries_exhausted"):a("request_context.queries_exhausted_for_today")):t.setError(o.message||a("request_context.something_wrong")):t.setError(a("request_context.something_wrong"))},onMessage:o=>{var I,q,M,R,k,G;const c=JSON.parse(o.data),N=c.data.content;((I=c==null?void 0:c.data)==null?void 0:I.eventType)==="SYSTEM"&&(c!=null&&c.data.hasOwnProperty("settings")&&(t.setChatId((M=(q=c==null?void 0:c.data)==null?void 0:q.settings)==null?void 0:M.chatId),t.editMessageNodeById(t.getLastMessage().parentId,w=>(w={...w,id:c.data.settings.userMessage.id},w)),t.editMessageNodeById(t.getLastMessage().id,w=>(w={...w,id:c.data.settings.assistantMessage.id,parentId:c.data.settings.userMessage.id},w))),c!=null&&c.data.hasOwnProperty("questions")&&t.setQuestions((R=c==null?void 0:c.data)==null?void 0:R.questions),(k=c==null?void 0:c.data)!=null&&k.metadata&&t.editMessageNodeById(t.getLastMessage().id,w=>(w={...w,metadata:{...w.metadata,...c.data.metadata}},w)),(G=c==null?void 0:c.data)!=null&&G.attachments&&t.editMessageNodeById(t.getLastMessage().id,w=>(w={...w,attachments:[...c.data.attachments]},w))),t.editMessageNodeById(t.getLastMessage().id,w=>(w.status==="LOADING"?(w.content=N,w.role="assistant",w.status="STREAMING"):w.status==="STREAMING"&&(w.content=`${w.content}${N}`),w))},onOpen:async o=>{o.ok&&o.headers.get("X-Request-Id")&&S(o.headers.get("X-Request-Id"))}}),l=(T==null?void 0:T.status)==="success"||(T==null?void 0:T.status)==="idle",x=async o=>{var I,q,M,R;t.setIsPromptingAvailable(!1),T.reset(),t.setError(null),t.setQuestions([]);const c=A.data.language;t.appendMessageThread([{content:o,id:Q(),parentId:((I=t.activeThread[t.activeThread.length-1])==null?void 0:I.id)??"root",role:"user",status:"SUCCESS"},{content:"",id:Q(),parentId:"",role:"system",status:"LOADING"}]);const N={context:{forwarding:!1,messages:i,signature:"",thread:t.activeThread,user:(R=(M=(q=document==null?void 0:document.querySelector("div.gb_b a"))==null?void 0:q.getAttribute("aria-label"))==null?void 0:M.replace("Google Account: ",""))==null?void 0:R.replace(`
`,"")},gmailPersona:C,language:c,modelId:C.model??`${r.usageDetails.type=="PAID"?"GPT 4":"GPT 3"}`,mountOn:m,query:o};t.setContext(""),T.execute(N),t.setContext(""),kt()},y=async()=>{t.setIsPromptingAvailable(!1);const o=A.data.language;t.setError(null),t.insertMessageNode(t.activeThread[t.activeThread.length-2].id,{content:"",id:Q(),parentId:t.activeThread[t.activeThread.length-2].id,role:"system",status:"LOADING"});const c={context:{forwarding:!1,messages:i,signature:"",thread:t.activeThread.splice(0,t.activeThread.length-2),user:document.querySelector("div.gb_b a").getAttribute("aria-label").replace("Google Account: ","").replace(`
`,"")},gmailPersona:C,language:o,modelId:(C==null?void 0:C.model)??`${r.usageDetails.type=="PAID"?"GPT 4":"GPT 3"}`,mountOn:m,query:t.activeThread[t.activeThread.length-2].content};T.execute(c)};return b.useEffect(()=>{f&&r.isAuthenticated&&(x(f),u(""))},[]),b.useEffect(()=>{var c,N,I,q,M,R,k,G;P&&P.disconnect();const o=new IntersectionObserver(function(w){var D,W,$;w[0].isIntersecting?(D=document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot"))==null||D.querySelector(`.${n}`).querySelector("#user-msg-body").classList.add("line-clamp-1"):($=(W=document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot"))==null?void 0:W.querySelector(`.${n}`))==null||$.querySelector("#user-msg-body").classList.remove("line-clamp-1")},{root:(c=document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot"))==null?void 0:c.querySelector(`.intersection-observer-root.${n}`),rootMargin:"0% 0% -95% 0%",threshold:[0,1]});(M=(q=(I=(N=document==null?void 0:document.getElementById("merlin-gmail-uicomponentportal"))==null?void 0:N.shadowRoot)==null?void 0:I.getElementById("reactAppRoot"))==null?void 0:q.querySelector(`.${n}`))!=null&&M.querySelector("#user-msg-body")&&(o.observe((G=(k=(R=document==null?void 0:document.getElementById("merlin-gmail-uicomponentportal"))==null?void 0:R.shadowRoot.getElementById("reactAppRoot"))==null?void 0:k.querySelector(`.${n}`))==null?void 0:G.querySelector("#user-msg-body")),B(o))},[t.activeThread.length]),r.isAuthenticated?g==="SETTINGS"?e.jsx(Bt,{setCurrentMode:d}):t.activeThread.length===0?e.jsxs(U,{className:"relative mx-auto w-[502px] p-2 shadow-lg",children:[e.jsx("div",{className:"bg-secondary absolute -right-3 -top-3 cursor-pointer rounded-full p-1 shadow-lg ",onClick:()=>h(!1),children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(ee,{className:"p-0",children:e.jsx(Ie,{placeholder:a("super_gmail.draft_nice"),onChange:o=>E(o.target.value),value:p,className:"h-48 resize-none border-transparent focus-visible:border-transparent focus-visible:ring-0",onKeyUp:o=>{o.key==="Enter"&&p.trim()&&!o.shiftKey&&(x(p.trim()),E(""))}})}),e.jsxs(te,{className:"mt-2 flex justify-between gap-2 p-0 ",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{variant:"secondary",className:"cursor-pointer py-2",onClick:()=>{_({eventName:"IntroduceMyselfQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Write an email introducing myself.")},children:a("super_gmail.introduce")}),e.jsx(fe,{variant:"secondary",className:"cursor-pointer py-2",onClick:()=>{_({eventName:"ColdEmailQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Write a cold email")},children:a("super_gmail.cold_email")})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(L,{variant:"ghost",size:"icon",className:"rounded-none border-r px-1 hover:bg-transparent",onClick:()=>{p.trim()&&x(p.trim()),E("")},children:e.jsx(ye,{className:"text-primary cursor-pointer "})}),e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>d("SETTINGS"),children:e.jsx(Re,{className:"cursor-pointer"})})]})]})]}):e.jsx(e.Fragment,{children:e.jsxs(U,{className:"relative mx-auto w-[502px] p-2 shadow-lg",children:[e.jsx("div",{className:"bg-secondary absolute -right-3 -top-3 cursor-pointer rounded-full p-1 shadow-lg ",onClick:()=>h(!1),children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(ee,{className:"p-0",children:e.jsx(re,{className:`intersection-observer-root h-[320px] ${n}`,children:e.jsxs("div",{className:"flex min-h-[320px] flex-col",children:[(v=t.activeThread)==null?void 0:v.map((o,c)=>e.jsx(_t,{msg:o,handleRegenerateLastMessage:y,chat:t,idx:c,handleInsert:s,handleSSE:T,isSSESuccessOrIdle:l,isLastMessage:t.activeThread.length-1===c&&o.role==="assistant",requestIdHeader:j,mountOn:m},o.id)),t.error&&!t.error.includes("Your queries have exhausted")&&e.jsxs("div",{className:"flex min-h-[280px] flex-grow flex-col justify-between px-2 text-red-500",children:[e.jsx("div",{className:"p-0 text-sm",children:t.error}),e.jsx("div",{className:"mt-2 flex items-center gap-2 text-sm",children:e.jsx(L,{onClick:()=>x(t.activeThread[t.activeThread.length-1].content),children:a("super_gmail.retry")})})]}),t.error&&t.error.includes("Your queries have exhausted")&&e.jsxs("div",{className:"flex min-h-[280px] flex-grow flex-col justify-between px-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex",children:[e.jsx("img",{className:"h-8 w-8",src:Te(rt),alt:"face-in-cloud"}),e.jsx("img",{className:"h-8 w-8",src:Te(at),alt:"lightning"})]}),e.jsx("div",{className:"p-0 text-sm",children:a("super_gmail.out_of_queries")})]}),e.jsx("div",{className:"mt-2 flex items-center gap-2 text-sm",children:e.jsx(L,{onClick:()=>Z(tt),children:a("super_gmail.go_pro")})})]})]})})}),e.jsxs(te,{className:"flex justify-between gap-2 p-0 pt-1 ",children:[e.jsxs("div",{className:"relative flex w-full items-center",children:[e.jsx(De,{onChange:o=>E(o.target.value),value:p,id:"promptInput",className:"pr-8",placeholder:a("super_gmail.follow_up_prompt"),autoComplete:"off",onKeyUp:o=>{o.key==="Enter"&&l&&p.trim()&&(x(p.trim()),E(""))}}),l?e.jsx(ye,{onClick:()=>{p.trim()&&l&&(x(p.trim()),E(""))},className:"text-primary bg-background absolute right-2 cursor-pointer"}):e.jsx(L,{size:"icon",variant:"ghost",className:"absolute right-2 h-5 w-5 text-xs",onClick:()=>{_({eventName:"StopGenerating",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),t.getLastMessage().content==""&&t.deleteLastMessage(),T.close()},children:e.jsx(Mt,{className:"plain-icon-color h-5 w-5 animate-pulse fill-red-600 stroke-[1.5]"})}),e.jsx(We,{children:l&&(a("super_gmail.shorten").toLowerCase().includes(p.toLowerCase())||a("super_gmail.lengthen").toLowerCase().includes(p.toLowerCase())||a("super_gmail.improve").toLowerCase().includes(p.toLowerCase())||a("super_gmail.simplify").toLowerCase().includes(p.toLowerCase())||a("super_gmail.fix_spelling").toLowerCase().includes(p.toLowerCase()))&&e.jsx(X.div,{initial:{opacity:0,originY:0,scaleY:0},animate:{opacity:1,scaleY:1},exit:{opacity:0,originY:0,scaleY:0},className:"absolute top-10  w-4/5 ",children:e.jsx(U,{className:"rounded-md py-2",children:e.jsx(re,{className:"max-h-28 overflow-y-scroll",children:e.jsxs("div",{className:"flex w-full flex-col gap-1 text-sm",children:[a("super_gmail.shorten").toLowerCase().includes(p.toLowerCase())&&e.jsx("div",{onClick:()=>{_({eventName:"ShortenQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Shorten it to 50 words")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:a("super_gmail.shorten")}),a("super_gmail.improv").toLowerCase().includes(p.toLowerCase())&&e.jsx("span",{onClick:()=>{_({eventName:"ImproveWritingQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Improve writing")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:a("super_gmail.improve")}),a("super_gmail.simplify").toLowerCase().includes(p.toLowerCase())&&e.jsx("span",{onClick:()=>{_({eventName:"SimplifyQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Simplify the language")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:a("super_gmail.simplify")}),a("super_gmail.lengthen").toLowerCase().includes(p.toLowerCase())&&e.jsx("span",{onClick:()=>{_({eventName:"LengthenQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Make it longer and verbose")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:a("super_gmail.lengthen")}),a("super_gmail.fix_spelling").toLowerCase().includes(p.toLowerCase())&&e.jsx("span",{onClick:()=>{_({eventName:"FixSpellingGrammarQuickPrompt",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),x("Fix spelling & grammar")},className:"hover:bg-secondary cursor-pointer px-2 py-1",children:a("super_gmail.fix_spelling")})]})})})})})]}),e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>{_({eventName:"SettingsBtn",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/SuperGmail"}),d("SETTINGS")},children:e.jsx(Re,{className:"cursor-pointer"})})]})]})}):e.jsxs(U,{className:"relative mx-auto w-[502px] p-2 shadow-lg",children:[e.jsx("div",{className:"bg-secondary absolute -right-3 -top-3 cursor-pointer rounded-full p-1 shadow-lg ",onClick:()=>h(!1),children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(Oe,{className:"mb-2 p-0",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-5 w-5",children:e.jsx(ae,{})}),e.jsx("span",{className:"text-lg",children:a("merlin")})]})}),e.jsx(H,{}),e.jsx(ee,{className:"px-2 py-3 text-sm",children:a("super_gmail.login")}),e.jsx(te,{className:"flex justify-between gap-2 px-2 py-0 ",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{onClick:()=>Z(Ee),children:a("super_gmail.login2")}),e.jsx(L,{variant:"ghost",onClick:()=>Z(Ee),children:a("super_gmail.signup")})]})})]})}const Gt=({attributes:s,handleInsert:n,id:i,setIsVisible:m,setPopperElement:h,styles:a,update:r})=>{const[g,d]=b.useState(!0),[j,S]=b.useState(!0);return b.useEffect(()=>{const t=new MutationObserver(be(()=>{if(r&&r(),!document.querySelector(`.${i}`)){d(!1),t.disconnect();return}},100));return t.observe(document.body,{childList:!0,subtree:!0}),()=>t.disconnect()},[i,r]),b.useEffect(()=>{const t=new MutationObserver(()=>{try{document.querySelector(`.${i}`).closest(".nH").style.display==="none"?S(!1):S(!0)}catch{}});return t.observe(document.querySelector(`.${i}`).closest(".nH"),{attributeFilter:["style"],attributes:!0}),()=>t.disconnect()},[i]),g?e.jsx("div",{ref:h,style:a.popper,...s.popper,className:`mb-48 ${j?"":"hidden"}`,children:e.jsx(X.div,{initial:{opacity:0,scale:0,y:150},animate:{opacity:1,scale:1,y:0},children:e.jsx(Ae,{handleInsert:n,setIsVisible:m,mountOn:"GMAIL_COMPOSE",id:i})})}):null};function Ft({id:s}){const[n,i]=se.useState(null),[m,h]=se.useState(null),{attributes:a,forceUpdate:r,styles:g}=Be(n,m,{placement:"top"}),[d,j]=b.useState(!1),S=O(u=>u.usingAIComposeBtn),t=O(u=>u.toggleUsingAIComposeBtn),f=u=>{try{const A=/^Subject: .*(\r?\n|\r)/,C=u.trim().replace(A,"").split(`
`).map(B=>B===""?"<div></div><br/>":`<div>${B}</div>`);document.querySelector(`.fab-writer.${s}`).closest(".nH.Hd").querySelector("[contenteditable=true]").innerHTML=C.join(`
`)+`
`+document.querySelector(`.fab-writer.${s}`).closest(".nH.Hd").querySelector("[contenteditable=true]").innerHTML;const P=u.trim().match(A);P&&(document.querySelector(`.fab-writer.${s}`).closest(".nH.Hd").querySelector("[name='subjectbox']").value=P[0]),j(!1)}catch{}};return b.useEffect(()=>{S&&(j(!0),t())},[]),e.jsx(ve,{children:e.jsx(qe,{client:Ne,persistOptions:{dehydrateOptions:{shouldDehydrateQuery:u=>{const{queryKey:A}=u;return!(A.includes("paginatedPublicChatbots")||A.includes("searchedChatbots"))}},persister:Ce},children:e.jsx(ke,{children:e.jsx(Se,{children:e.jsx(Ge,{children:e.jsx(we,{websiteOverride:!0,children:e.jsxs("div",{className:"flex w-full justify-center",children:[e.jsx("div",{ref:i,className:`${s}`}),d&&J.createPortal(e.jsx(Gt,{setPopperElement:h,styles:g,attributes:a,setIsVisible:j,id:s,handleInsert:f,update:r}),document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot")),J.createPortal(e.jsxs(L,{type:"button",onClick:()=>j(u=>!u),className:"px-2",children:[e.jsx("div",{className:"mr-1 h-5 w-5",children:e.jsx(ae,{})}),e.jsx("span",{children:"AI"})]}),document.querySelector(`.merlin.fab-btn.${s}`).shadowRoot.getElementById("reactAppRootBtn"))]})})})})})})})}const $t=({attributes:s,handleInsert:n,id:i,mailThread:m,setIsVisible:h,setPopperElement:a,styles:r,update:g})=>{const[d,j]=b.useState(!0),[S,t]=b.useState(!0);return b.useEffect(()=>{const f=new MutationObserver(be(()=>{if(g&&g(),!document.querySelector(`.${i}`)){j(!1),f.disconnect();return}},100));return f.observe(document.body,{childList:!0,subtree:!0}),()=>f.disconnect()},[i,g]),b.useEffect(()=>{const f=new MutationObserver(()=>{try{document.querySelector(`.${i}`).closest(".nH").style.display==="none"?t(!1):t(!0)}catch{}});return f.observe(document.querySelector(`.${i}`).closest(".nH"),{attributeFilter:["style"],attributes:!0}),()=>f.disconnect()},[i]),d?e.jsx("div",{ref:a,style:r.popper,...s.popper,className:`mb-48 ${S?"":"hidden"}`,children:e.jsx(X.div,{initial:{opacity:0,scale:0,y:150},animate:{opacity:1,scale:1,y:0},children:e.jsx(Ae,{handleInsert:n,setIsVisible:h,mountOn:"GMAIL_REPLY",id:i,mailThread:m})})}):null};function Ot({id:s}){const[n,i]=se.useState(null),[m,h]=se.useState(null),{attributes:a,forceUpdate:r,styles:g}=Be(n,m,{placement:"top"}),[d,j]=b.useState([]),[S,t]=b.useState(!1),f=O(p=>p.usingAIComposeBtn),u=O(p=>p.toggleUsingAIComposeBtn);b.useEffect(()=>{const p=(C,P)=>{var B,T,l,x,y,v,o,c,N,I,q,M,R;if(C!=null&&C.querySelector("blockquote.gmail_quote")){const k=C.querySelector("blockquote.gmail_quote"),G=((T=(B=k.parentNode)==null?void 0:B.querySelector(".gmail_attr"))==null?void 0:T.textContent)??((l=k.parentNode)==null?void 0:l.textContent)??"",w=new RegExp("(?<=<)(.*?)(?=>)"),D=/(\d{1,2} \w{3} \d{4} at \d{2}:\d{2})/,W=new RegExp("(?<=\\s)([\\w\\s]+)(?=\\s<)"),$=new RegExp("(?<=<)(.*?)(?=>)"),ie=/\w{3}, \w{3} \d{1,2}, \d{4} at \d{1,2}:\d{2}\s(?:AM|PM)/,le=((y=(x=G.match(W))==null?void 0:x[0])==null?void 0:y.replace(/\b(?:AM|PM)\b/g,""))??"",ce=((v=G.match(w))==null?void 0:v[0])??((o=G.match($))==null?void 0:o[0]),me=((c=G.match(D))==null?void 0:c[0])??((N=G.match(ie))==null?void 0:N[0]),K=(R=(q=k.textContent)==null?void 0:q.replace((I=k.querySelector("blockquote.gmail_quote"))==null?void 0:I.textContent,""))==null?void 0:R.replace((M=k.querySelector(".gmail_attr"))==null?void 0:M.textContent,"");P.push({content:K==null?void 0:K.replace(/\s\s+/gm," "),email:ce,name:le,timestamp:me}),p(C.querySelector("blockquote.gmail_quote"),P)}};(async()=>{var P,B,T,l,x,y;const C=[];(l=(T=(B=(P=document.querySelector(`.merlin.fab-btn.${s}`))==null?void 0:P.closest(".ip.adB"))==null?void 0:B.querySelector("img.ajT"))==null?void 0:T.parentElement)==null||l.click(),p((y=(x=document.querySelector(`.merlin.fab-btn.${s}`))==null?void 0:x.closest(".ip.adB"))==null?void 0:y.querySelector(".gmail_quote"),C),j(C.reverse())})()},[s]);const A=p=>{try{const E=/^Subject: .*(\r?\n|\r)/;p=p.trim().replace(E,"");const P=p.split(`
`).map(B=>B===""?"<div></div><br/>":`<div>${B}</div>`);document.querySelector(`.fab-writer.${s}`).closest(".ip.adB").querySelector("[contenteditable=true]").innerHTML=P.join(`
`)+`
`+document.querySelector(`.fab-writer.${s}`).closest(".ip.adB").querySelector("[contenteditable=true]").innerHTML,t(!1)}catch{}};return b.useEffect(()=>{f&&(t(!0),u())},[]),e.jsx(ve,{children:e.jsx(qe,{client:Ne,persistOptions:{dehydrateOptions:{shouldDehydrateQuery:p=>{const{queryKey:E}=p;return!(E.includes("paginatedPublicChatbots")||E.includes("searchedChatbots"))}},persister:Ce},children:e.jsx(ke,{children:e.jsx(Se,{children:e.jsx(Ge,{children:e.jsx(we,{websiteOverride:!0,children:e.jsxs("div",{className:"flex w-full justify-center",children:[S&&J.createPortal(e.jsx($t,{setPopperElement:h,styles:g,attributes:a,setIsVisible:t,id:s,handleInsert:A,update:r,mailThread:d}),document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot")),J.createPortal(e.jsxs(L,{type:"button",onClick:()=>t(p=>!p),className:`z-50 px-2 ${s}`,ref:i,children:[e.jsx("div",{className:" mr-1 h-5 w-5",children:e.jsx(ae,{})}),e.jsx("span",{children:"AI"})]}),document.querySelector(`.merlin.fab-btn.${s}`).shadowRoot.getElementById("reactAppRootBtn"))]})})})})})})})}const Dt=()=>{const{...s}=b.useContext(Ke);return{getUserPrompts:dt({queryFn:async()=>s.isLoading||!s.isAuthenticated?null:await Ve(),queryKey:["userPrompts"]})}},Wt=()=>{const s=Rt();return Lt({mutationFn:async i=>await Je(i),onSuccess:i=>{s.setQueryData(["userPrompts"],i)}})},zt=[{promptName:"Friendly",promptTag:"GmailReply",promptText:"Write a friendly reply in an informal tone"},{promptName:"Funny",promptTag:"GmailReply",promptText:"Write a funny reply"},{promptName:"Professional",promptTag:"GmailReply",promptText:"Write a professional reply"}],Ut=({handleInsert:s,id:n,mailThread:i,setIsVisible:m})=>e.jsx("div",{className:"absolute translate-x-[60vw] translate-y-1/4 ",children:e.jsx(X.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},children:e.jsx(Ae,{setIsVisible:m,mailThread:i,handleInsert:s,mountOn:"GMAIL_REPLY",id:n})})}),Ht=({id:s})=>{var C,P,B,T;const{t:n}=oe(),[i,m]=b.useState(!1),[h,a]=b.useState([]),[r,g]=b.useState(""),d=O(l=>l.setQuickPromptAIReply),j=b.useRef(null),{getUserPrompts:S}=Dt();Wt();const t=b.useMemo(()=>{var l,x,y;return(y=(x=(l=S==null?void 0:S.data)==null?void 0:l.userPrompts)==null?void 0:x.userMade)==null?void 0:y.filter(v=>{var o,c,N,I,q;return((o=v==null?void 0:v.promptTag)==null?void 0:o.includes("GmailReply"))&&(((N=(c=v==null?void 0:v.promptName)==null?void 0:c.toLocaleLowerCase())==null?void 0:N.includes(r==null?void 0:r.toLocaleLowerCase()))||((q=(I=v==null?void 0:v.promptText)==null?void 0:I.toLocaleLowerCase())==null?void 0:q.includes(r==null?void 0:r.toLocaleLowerCase())))})},[r,(P=(C=S==null?void 0:S.data)==null?void 0:C.userPrompts)==null?void 0:P.userMade]),f=b.useMemo(()=>{var l,x,y;return(y=(x=(l=S==null?void 0:S.data)==null?void 0:l.userPrompts)==null?void 0:x.userMade)==null?void 0:y.filter(v=>{var o,c,N,I,q;return!((o=v==null?void 0:v.promptTag)!=null&&o.includes("GmailReply"))&&(((N=(c=v==null?void 0:v.promptName)==null?void 0:c.toLocaleLowerCase())==null?void 0:N.includes(r==null?void 0:r.toLocaleLowerCase()))||((q=(I=v==null?void 0:v.promptText)==null?void 0:I.toLocaleLowerCase())==null?void 0:q.includes(r==null?void 0:r.toLocaleLowerCase())))})},[r,(T=(B=S==null?void 0:S.data)==null?void 0:B.userPrompts)==null?void 0:T.userMade]),u=zt.filter(l=>{var x,y,v,o,c;return((x=l==null?void 0:l.promptTag)==null?void 0:x.includes("GmailReply"))&&(((v=(y=l==null?void 0:l.promptName)==null?void 0:y.toLocaleLowerCase())==null?void 0:v.includes(r==null?void 0:r.toLocaleLowerCase()))||((c=(o=l==null?void 0:l.promptText)==null?void 0:o.toLocaleLowerCase())==null?void 0:c.includes(r==null?void 0:r.toLocaleLowerCase())))}),A=(l,x)=>{var y,v,o,c,N,I,q,M,R,k,G,w,D,W;if(l!=null&&l.querySelector("blockquote.gmail_quote")){const $=((v=(y=l.querySelector("blockquote.gmail_quote").parentNode)==null?void 0:y.querySelector(".gmail_attr"))==null?void 0:v.textContent)??((o=l.querySelector("blockquote.gmail_quote").parentNode)==null?void 0:o.textContent)??"",ie=new RegExp("(?<=<)(.*?)(?=>)"),le=/(\d{1,2} \w{3} \d{4} at \d{2}:\d{2})/,ce=new RegExp("(?<=\\s)([\\w\\s]+)(?=\\s<)"),me=new RegExp("(?<=<)(.*?)(?=>)"),K=/\w{3}, \w{3} \d{1,2}, \d{4} at \d{1,2}:\d{2}\s(?:AM|PM)/,Ue=((N=(c=$.match(ce))==null?void 0:c[0])==null?void 0:N.replace(/\b(?:AM|PM)\b/g,""))??"",He=((I=$.match(ie))==null?void 0:I[0])??((q=$.match(me))==null?void 0:q[0]),Qe=((M=$.match(le))==null?void 0:M[0])??((R=$.match(K))==null?void 0:R[0]),ue=(W=(w=(k=l.querySelector("blockquote.gmail_quote"))==null?void 0:k.textContent)==null?void 0:w.replace((G=l.querySelector("blockquote.gmail_quote").querySelector("blockquote.gmail_quote"))==null?void 0:G.textContent,""))==null?void 0:W.replace((D=l.querySelector("blockquote.gmail_quote").querySelector(".gmail_attr"))==null?void 0:D.textContent,"");x.push({content:ue==null?void 0:ue.replace(/\s\s+/gm," "),email:He,name:Ue,timestamp:Qe}),A(l.querySelector("blockquote.gmail_quote"),x)}},p=async({prompt:l})=>{var v,o,c,N,I,q,M;const x=[],y=(v=document==null?void 0:document.querySelector(`.merlin-external.${s}`))==null?void 0:v.closest('[role="listitem"]');x.push({content:(I=(N=(o=y==null?void 0:y.querySelector(".a3s.aiL"))==null?void 0:o.textContent)==null?void 0:N.replace((c=y.querySelector("blockquote.gmail_quote"))==null?void 0:c.textContent,""))==null?void 0:I.replace(/\s\s+/gm," "),email:y==null?void 0:y.querySelector("[name][email]").getAttribute("email"),name:y==null?void 0:y.querySelector("[name][email]").getAttribute("name"),timestamp:(q=y==null?void 0:y.querySelector("[alt][title]"))==null?void 0:q.getAttribute("title")}),A((M=y==null?void 0:y.querySelector(".a3s.aiL"))==null?void 0:M.querySelector(".gmail_quote"),x),a(x.reverse()),d(l),await new Promise(R=>{m(k=>!k),setTimeout(()=>R(!0),50)}),await new Promise(R=>{m(!0),setTimeout(()=>R(!0),50)})},E=l=>{try{const x=/^Subject: .*(\r?\n|\r)/;l=l.trim().replace(x,"");const v=l.split(`
`).map(o=>o===""?"<div></div><br/>":`<div>${o}</div>`);try{document.querySelector(`.merlin-external.${s}`).closest(".gA.gt").querySelector(".ams.bkI").click()}catch{try{document.querySelector(`.merlin-external.${s}`).closest(".gA.gt").querySelector(".ams.bkH").click()}catch{}}setTimeout(()=>document.querySelector(`.merlin-external.${s}`).closest(".gA.gt").querySelector("[contenteditable=true]").innerHTML=v.join(`
`)+`

`+document.querySelector(`.merlin-external.${s}`).closest(".gA.gt").querySelector("[contenteditable=true]").innerHTML,50),m(!1)}catch{}};return b.useEffect(()=>{j.current&&(j.current.style.height="auto",j.current.style.height=j.current.scrollHeight+"px")},[r]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative mb-2.5 ml-24 flex items-end gap-3 py-1",id:"ai-reply",children:[e.jsx("div",{className:"absolute -left-10 top-1.5 h-7 w-7",children:e.jsx(ae,{})}),e.jsx(Ie,{onChange:l=>g(String(l.target.value)),rows:1,value:r,ref:j,placeholder:"Write your reply to generate with AI",className:Pe("peer min-h-1 w-80 transition-all duration-200 ease-in-out focus:w-[26.68rem]",r.length&&"w-[26.68rem]")}),e.jsxs(L,{onClick:()=>{_({eventName:"GenerateAIReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),p({prompt:r}),g("")},variant:"default",className:Pe("items-center justify-center peer-focus:flex",!r.length&&"hidden"),children:[n("Generate"),e.jsx(ye,{className:"ml-2 h-5 w-5"})]}),!r.length&&e.jsxs(e.Fragment,{children:[e.jsx(L,{onClick:()=>{_({eventName:"YesQuickReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),p({prompt:"Respond to these matters affirmatively, expressing your interest."})},variant:"outline",className:"peer-focus:hidden",children:n("yes")}),e.jsx(L,{onClick:()=>{_({eventName:"NoQuickReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),p({prompt:"Respond to these matters saying no, expressing your rejection or dis-interest."})},variant:"outline",className:"peer-focus:hidden",children:n("no")}),e.jsx(L,{onClick:()=>{_({eventName:"FollowUpQuickReply",eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),p({prompt:"Follow up."})},variant:"outline",className:"peer-focus:hidden",children:n("super_gmail.follow_up")})]}),e.jsx(We,{children:(r==null?void 0:r.length)&&((u==null?void 0:u.length)||t&&(t==null?void 0:t.length)||f&&(f==null?void 0:f.length))&&e.jsx(X.div,{initial:{opacity:0,originY:0,scaleY:0},animate:{opacity:1,scaleY:1},exit:{opacity:0,originY:0,scaleY:0},className:"left-26 absolute top-12 z-10 ml-0 w-[26.68rem]",children:e.jsx(U,{className:"rounded-md py-2",children:e.jsx(re,{className:"max-h-28 overflow-scroll",children:e.jsxs("div",{className:"flex w-full flex-col gap-1 text-sm",children:[e.jsxs(e.Fragment,{children:[t&&(t==null?void 0:t.length)!==0&&e.jsx("p",{className:"text-muted-foreground ml-2 text-xs",children:"Gmail Prompts"}),t&&(t==null?void 0:t.map(l=>e.jsx("div",{onClick:()=>{p({prompt:l.promptText}),g("")},className:"hover:bg-secondary cursor-pointer px-3 py-1",children:n(l.promptName)},l.id)))]}),t&&(t==null?void 0:t.length)!==0&&(u==null?void 0:u.length)!==0&&e.jsx(H,{}),e.jsxs(e.Fragment,{children:[(u==null?void 0:u.length)!==0&&e.jsx("p",{className:"text-muted-foreground ml-2 mt-1 text-xs",children:"Recommended Prompts"}),u==null?void 0:u.map((l,x)=>e.jsx("div",{onClick:()=>{_({eventName:`${l.promptName}QuickReply`,eventType:"Button",feature:"GmailReplyBar",firedFromFile:"features/tgl/gMail/AIReplyExternal"}),p({prompt:l.promptText}),g("")},className:"hover:bg-secondary cursor-pointer px-3 py-1",children:n(`${l.promptName} Reply`)},x))]}),(u==null?void 0:u.length)!==0&&f&&(f==null?void 0:f.length)!==0&&e.jsx(H,{}),e.jsxs(e.Fragment,{children:[f&&(f==null?void 0:f.length)!==0&&e.jsx("p",{className:"text-muted-foreground ml-2 mt-1 text-xs",children:"Other Prompts"}),f&&(f==null?void 0:f.map(l=>e.jsx("div",{onClick:()=>{p({prompt:l.promptText}),g("")},className:"hover:bg-secondary cursor-pointer px-3 py-1",children:n(l.promptName)},l.id)))]})]})})})})})]}),i&&J.createPortal(e.jsx(Ut,{setIsVisible:m,mailThread:h,handleInsert:E,id:s}),document.getElementById("merlin-gmail-uicomponentportal").shadowRoot.getElementById("reactAppRoot"))]})};function Qt({id:s}){const[n]=ze();return n.merlinOnGmail.visible?e.jsx(ve,{children:e.jsx(Se,{children:e.jsx(qe,{client:Ne,persistOptions:{persister:Ce},children:e.jsx(we,{websiteOverride:!0,children:e.jsx(Ht,{id:s})})})})}):null}function Yt(){const s=O(h=>h.toggleUsingAIComposeBtn),[n]=ze(),[i,m]=b.useState(!0);return b.useEffect(()=>{var r;const h=(r=document.querySelector(".T-I-KE"))==null?void 0:r.closest("[role='navigation']"),a=document.querySelector("[aria-label='Main menu']");if(h){m(!1);const g=new MutationObserver(()=>{h.classList.contains("bym")||a.getAttribute("aria-expanded")==="true"?m(!0):m(!1)});g.observe(h,{attributeFilter:["class"],attributes:!0}),g.observe(a,{attributeFilter:["class"],attributes:!0}),a.getAttribute("aria-expanded")==="true"&&!h.classList.contains("bhz")&&m(!0)}},[]),b.useEffect(()=>{document.querySelector(".T-I-KE").style.zIndex="1",document.querySelector(".T-I-KE").parentNode.style.position="relative"},[]),n.merlinOnGmail.visible&&n.Aibtn.visible?e.jsx("button",{type:"button",onClick:()=>{_({eventName:"GlobalAiComposeBtn",eventType:"Button",feature:"SuperGmail",firedFromFile:"features/tgl/gMail/components/AIComposeBtn"}),s(),document.querySelector(".T-I-KE").click()},className:`animate-border absolute bottom-0 left-32 top-0 items-stretch rounded-r-2xl bg-gradient-to-t from-fuchsia-200 via-purple-300 to-indigo-100 p-0.5 shadow-lg active:shadow-sm ${i?"":"hidden"}`,children:e.jsx("div",{className:"text-primary bg-background flex h-full items-center rounded-r-2xl px-5 pl-7 transition-all hover:pl-8",children:"✨AI"})}):null}const Kt=()=>new Promise(s=>{if(window.location.origin.includes("mail.google.com")){const n=new MutationObserver(()=>{const i=document.getElementById("loading");i.style.display==="none"&&(s(i),n.disconnect())});n.observe(document.body,{childList:!0,subtree:!1})}}),Vt=async s=>{const n=`u${Q()}`,i=document.createElement("merlin-component"),m=document.createElement("merlin-button-component");i.className=`merlin fab-writer ${n}`,m.className=`merlin fab-btn ${n}`;const h=i.attachShadow({mode:"open"}),a=m.attachShadow({mode:"open"}),r=document.createElement("style"),g=document.createElement("style");r.textContent=`${z}
      :host(.merlin.fab-writer) {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: absolute;
        width: 100%;
        display: block;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        z-index: 1000;
      }
      .fabStrip {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .fabStrip ::-webkit-scrollbar {
        display: none;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      `,g.textContent=`${z}
      .fab-btn{
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      `;const d=document.createElement("div");d.id="reactAppRoot",d.className="reactAppRoot fabStrip";const j=document.createElement("div");j.id="reactAppRootBtn",j.className="reactAppRootBtn fabBtn center-with-flex",h.appendChild(r),h.appendChild(d),s.querySelector("#sbddm").insertAdjacentElement("afterend",i),a.appendChild(g),a.appendChild(j);try{const u=s.querySelector(".gU.aYL");u.style.cssText="display: flex; gap: 0.5em; justify-content: center; align-items: center;",u.append(m)}catch{}const S={fowarding:!1,messages:[],signature:"",user:""};let t=null;try{t=document.querySelector("div.gb_b a").getAttribute("aria-label").replace("Google Account: ","").replace(`
`,""),S.user=t}catch{}ne.forEach(u=>{d.addEventListener(u,A=>{A.stopPropagation()})});const f=Y(d);Y(j),f.render(e.jsx(Ft,{id:n}))},Jt=async s=>{const n=`u${Q()}`,i=document.createElement("merlin-component"),m=document.createElement("merlin-button-component");i.className=`merlin fab-writer ${n}`,m.className=`merlin fab-btn ${n}`;const h=i.attachShadow({mode:"open"}),a=m.attachShadow({mode:"open"}),r=document.createElement("style"),g=document.createElement("style");r.textContent=`${z}
      :host(.merlin.fab-writer) {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: absolute;
        width: 100%;
        display: block;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        z-index: 1000;
      }
      .fabStrip {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .fabStrip ::-webkit-scrollbar {
        display: none;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      `,g.textContent=`${z}
      .fab-btn{
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      `;const d=document.createElement("div");d.id="reactAppRoot",d.className="reactAppRoot fabStrip";const j=document.createElement("div");j.id="reactAppRootBtn",j.className="reactAppRootBtn fabBtn center-with-flex",h.appendChild(r),h.appendChild(d),s.querySelector("#sbddm").insertAdjacentElement("afterend",i),a.appendChild(g),a.appendChild(j);try{const u=s.querySelector(".gU.aYL");u.style.cssText="display: flex; gap: 0.5em; justify-content: center; align-items: center;",u.append(m)}catch{}const S={fowarding:!1,messages:[],signature:"",user:""};let t=null;try{t=document.querySelector("div.gb_b a").getAttribute("aria-label").replace("Google Account: ","").replace(`
`,""),S.user=t}catch{}ne.forEach(u=>{d.addEventListener(u,A=>{A.stopPropagation()})});const f=Y(d);Y(j),f.render(e.jsx(Ot,{id:n}))},Xt=async s=>{const n=`u${Q()}`,i=document.createElement("merlin-component");i.className=`merlin fab-writer merlin-external ${n}`;const m=i.attachShadow({mode:"open"}),h=document.createElement("style");h.textContent=`${z}
      :host(.merlin.fab-writer) {
        all: initial; /* 1st rule so subsequent properties are reset. */
        width: 100%;
        display: block;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        z-index: 1000;
      }
      .fabStrip {
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .fabStrip ::-webkit-scrollbar {
        display: none;
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      `;const a=document.createElement("div");a.id="reactAppRoot",a.className="reactAppRoot fabStrip",ne.forEach(g=>{a.addEventListener(g,d=>{d.stopPropagation()})}),m.appendChild(h),m.appendChild(a),s.prepend(i),Y(a).render(e.jsx(Qt,{id:n}))},Zt=async()=>{var h;const s=document.createElement("merlin-component");s.className="merlin ai-compose-btn";const n=s.attachShadow({mode:"open"}),i=document.createElement("style");i.textContent=`${z}
      .ai-compose-btn{
        all: initial; /* 1st rule so subsequent properties are reset. */
        position: relative;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      `;const m=document.createElement("div");m.id="reactAppRootBtn",m.className="reactAppRootBtn",n.appendChild(i),n.appendChild(m),(h=document.querySelector(".T-I-KE"))!=null&&h.parentNode?document.querySelector(".T-I-KE").parentNode.append(s):document.querySelector(".z0")&&document.querySelector(".z0").append(s),Y(m).render(e.jsx(Yt,{}))},es=async()=>{if(document.getElementById("merlin-gmail-uicomponentportal"))return;const s=document.createElement("merlin-component");s.id="merlin-gmail-uicomponentportal",s.className="merlin merlin-gmail-uicomponentportal";const n=s.attachShadow({mode:"open"}),i=document.createElement("style");i.textContent=`${z}
    :host(#merlin-gmail-uicomponentportal) {
    }   
    .reactAppRoot {
      all: initial; /* 1st rule so subsequent properties are reset. */
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 2147483640;
    }
    `.replaceAll(":root",":host");const m=document.createElement("div");m.id="reactAppRoot",m.className="reactAppRoot",ne.forEach(h=>{m.addEventListener(h,a=>{a.stopPropagation()})}),n.appendChild(i),n.appendChild(m),document.documentElement.append(s)},ts=async()=>{es();const s=await Ye();if(s&&!s.fabStrip.gmail.visible)return;await Kt();const n=new MutationObserver(be(()=>{const m=document.querySelectorAll(".nH.Hd");if(m.length>0)for(let r=0;r<m.length;r+=1){const g=m[r].querySelector("merlin-component"),d=m[r].querySelector("merlin-button-component");!g&&!d&&Vt(m[r])}const h=document.querySelectorAll(".ip.adB");if(h.length>0)for(let r=0;r<h.length;r+=1){const g=h[r].querySelector("merlin-component"),d=h[r].querySelector("merlin-button-component");!g&&!d&&Jt(h[r])}const a=document.querySelectorAll(".gA.gt");if(a.length>0){const r=a[a.length-1];let g=document.querySelector(".merlin.fab-writer.merlin-external");!r.querySelector(".merlin.fab-writer.merlin-external")&&g&&(g.remove(),g=null),g||Xt(r)}},300)),i={attributes:!0,childList:!0,subtree:!1};n.observe(document.body,i),Zt()};ts();
