import{p as ve}from"./purify.es-8e338605.js";import{w as qe}from"./backend-b5a741e2.js";import{g as xe}from"./index-825701e8.js";import{e as se}from"./utils-f7fcf05a.js";import{A as ne}from"./index-9b1f0f42.js";class P extends Error{constructor(t,r){super(t+" at position "+r),this.position=r}}const H=92,ee=47,Le=42,ae=123,W=125,ie=91,z=93,De=40,Oe=41,Ue=32,ce=10,ye=9,be=13,Te=8,Fe=12,Y=34,le=43,ue=45,Se=39,Ce=48,Ae=57,V=44,_e=46,Me=58,Ne=59,Ie=65,Pe=97,$e=69,Re=101,Ge=70,Qe=102,Be=160,He=8192,We=8202,ze=8239,Ve=8287,Je=12288,Ke=8220,Ze=8221,Xe=8216,Ye=8217,je=96,et=180;function tt(e){return e>=Ce&&e<=Ae||e>=Ie&&e<=Ge||e>=Pe&&e<=Qe}function J(e){return e>=Ce&&e<=Ae}function rt(e){return e>=32&&e<=1114111}function K(e){return nt.test(e)}const nt=/^[,:[\]/{}()\n+]$/;function he(e){return ct.test(e)||e&&Z(e.charCodeAt(0))}const ct=/^[[{\w-]$/;function ot(e){return e===ce||e===be||e===ye||e===Te||e===Fe}function B(e){return e===Ue||e===ce||e===ye||e===be}function st(e){return e===Be||e>=He&&e<=We||e===ze||e===Ve||e===Je}function Z(e){return Ee(e)||re(e)}function Ee(e){return e===Y||e===Ke||e===Ze}function fe(e){return e===Y}function re(e){return e===Se||e===Xe||e===Ye||e===je||e===et}function de(e){return e===Se}function Q(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const o=e.lastIndexOf(t);return o!==-1?e.substring(0,o)+(r?"":e.substring(o+1)):e}function F(e,t){let r=e.length;if(!B(e.charCodeAt(r-1)))return e+t;for(;B(e.charCodeAt(r-1));)r--;return e.substring(0,r)+t+e.substring(r)}function at(e,t,r){return e.substring(0,t)+e.substring(t+r)}function it(e){return/[,\n][ \t\r]*$/.test(e)}const lt={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},ut={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function ht(e){let t=0,r="";f()||q();const c=a(V);for(c&&n(),he(e[t])&&it(r)?(c||(r=F(r,",")),w()):c&&(r=Q(r,","));e.charCodeAt(t)===W||e.charCodeAt(t)===z;)t++,n();if(t>=e.length)return r;C();function f(){n();const s=S()||A()||u()||h()||y()||E();return n(),s}function n(){const s=t;let g=l();do g=i(),g&&(g=l());while(g);return t>s}function l(){let s="",g;for(;(g=B(e.charCodeAt(t)))||st(e.charCodeAt(t));)g?s+=e[t]:s+=" ",t++;return s.length>0?(r+=s,!0):!1}function i(){if(e.charCodeAt(t)===ee&&e.charCodeAt(t+1)===Le){for(;t<e.length&&!ft(e,t);)t++;return t+=2,!0}if(e.charCodeAt(t)===ee&&e.charCodeAt(t+1)===ee){for(;t<e.length&&e.charCodeAt(t)!==ce;)t++;return!0}return!1}function a(s){return e.charCodeAt(t)===s?(r+=e[t],t++,!0):!1}function m(s){return e.charCodeAt(t)===s?(t++,!0):!1}function b(){return m(H)}function S(){if(e.charCodeAt(t)===ae){r+="{",t++,n();let s=!0;for(;t<e.length&&e.charCodeAt(t)!==W;){let g;if(s?(g=!0,s=!1):(g=a(V),g||(r=F(r,",")),n()),!(u()||E())){e.charCodeAt(t)===W||e.charCodeAt(t)===ae||e.charCodeAt(t)===z||e.charCodeAt(t)===ie||e[t]===void 0?r=Q(r,","):x();break}n();const R=a(Me),$=t>=e.length;R||(he(e[t])||$?r=F(r,":"):_()),f()||(R||$?r+="null":_())}return e.charCodeAt(t)===W?(r+="}",t++):r=F(r,"}"),!0}return!1}function A(){if(e.charCodeAt(t)===ie){r+="[",t++,n();let s=!0;for(;t<e.length&&e.charCodeAt(t)!==z;)if(s?s=!1:a(V)||(r=F(r,",")),!f()){r=Q(r,",");break}return e.charCodeAt(t)===z?(r+="]",t++):r=F(r,"]"),!0}return!1}function w(){let s=!0,g=!0;for(;g;)s?s=!1:a(V)||(r=F(r,",")),g=f();g||(r=Q(r,",")),r=`[
`.concat(r,`
]`)}function u(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,g=e.charCodeAt(t)===H;if(g&&(t++,g=!0),Z(e.charCodeAt(t))){const N=fe(e.charCodeAt(t))?fe:de(e.charCodeAt(t))?de:re(e.charCodeAt(t))?re:Ee,R=t,$=r.length;let v='"';for(t++;;){if(t>=e.length)return s?(v=F(v,'"'),r+=v,!0):(t=R,r=r.substring(0,$),u(!0));if(N(e.charCodeAt(t))){const U=t,I=v.length;if(v+='"',t++,r+=v,n(),s||t>=e.length||K(e.charAt(t))||Z(e.charCodeAt(t)))return d(),!0;if(K(e.charAt(L(U-1))))return t=R,r=r.substring(0,$),u(!0);r=r.substring(0,$),t=U+1,v=v.substring(0,I)+"\\"+v.substring(I)}else{if(s&&K(e[t]))return v=F(v,'"'),r+=v,d(),!0;if(e.charCodeAt(t)===H){const U=e.charAt(t+1);if(ut[U]!==void 0)v+=e.slice(t,t+2),t+=2;else if(U==="u"){let G=2;for(;G<6&&tt(e.charCodeAt(t+G));)G++;G===6?(v+=e.slice(t,t+6),t+=6):t+G>=e.length?t=e.length:j()}else v+=U,t+=2}else{const U=e.charAt(t),I=e.charCodeAt(t);I===Y&&e.charCodeAt(t-1)!==H?(v+="\\"+U,t++):ot(I)?(v+=lt[U],t++):(rt(I)||k(U),v+=U,t++)}}g&&b()}}return!1}function d(){let s=!1;for(n();e.charCodeAt(t)===le;){s=!0,t++,n(),r=Q(r,'"',!0);const g=r.length;u()?r=at(r,g,1):r=F(r,'"')}return s}function h(){const s=t;if(e.charCodeAt(t)===ue&&(t++,D(s)))return!0;for(;J(e.charCodeAt(t));)t++;if(e.charCodeAt(t)===_e){if(t++,D(s))return!0;for(;J(e.charCodeAt(t));)t++}if(e.charCodeAt(t)===Re||e.charCodeAt(t)===$e){if(t++,(e.charCodeAt(t)===ue||e.charCodeAt(t)===le)&&t++,D(s))return!0;for(;J(e.charCodeAt(t));)t++}if(t>s){const g=e.slice(s,t),N=/^0\d/.test(g);return r+=N?'"'.concat(g,'"'):g,!0}return!1}function y(){return p("true","true")||p("false","false")||p("null","null")||p("True","true")||p("False","false")||p("None","null")}function p(s,g){return e.slice(t,t+s.length)===s?(r+=g,t+=s.length,!0):!1}function E(){const s=t;for(;t<e.length&&!K(e[t])&&!Z(e.charCodeAt(t));)t++;if(t>s){if(e.charCodeAt(t)===De)return t++,f(),e.charCodeAt(t)===Oe&&(t++,e.charCodeAt(t)===Ne&&t++),!0;{for(;B(e.charCodeAt(t-1))&&t>0;)t--;const g=e.slice(s,t);return r+=g==="undefined"?"null":JSON.stringify(g),e.charCodeAt(t)===Y&&t++,!0}}}function L(s){let g=s;for(;g>0&&B(e.charCodeAt(g));)g--;return g}function O(s){if(!J(e.charCodeAt(t))){const g=e.slice(s,t);throw new P("Invalid number '".concat(g,"', expecting a digit ").concat(T()),t)}}function D(s){return t>=e.length?(r+=e.slice(s,t)+"0",!0):(O(s),!1)}function k(s){throw new P("Invalid character "+JSON.stringify(s),t)}function C(){throw new P("Unexpected character "+JSON.stringify(e[t]),t)}function q(){throw new P("Unexpected end of json string",e.length)}function x(){throw new P("Object key expected",t)}function _(){throw new P("Colon expected",t)}function j(){const s=e.slice(t,t+6);throw new P('Invalid unicode character "'.concat(s,'"'),t)}function T(){return e[t]?"but got '".concat(e[t],"'"):"but reached end of input"}}function ft(e,t){return e[t]==="*"&&e[t+1]==="/"}const oe=7;function dt(e,t,r){switch(e){case"google":return"https://www.google.com/search";case"bing":return"https://www.bing.com/search";case"baidu":return t?"https://www.baidu.com/s":r?"https://image.baidu.com/search/acjson":"https://www.baidu.com/s";case"duckduckgo":return"https://duckduckgo.com/";case"yahoo":return t?"https://news.search.yahoo.com/search":r?"https://images.search.yahoo.com/search/images":"https://search.yahoo.com/search";case"naver":return"https://search.naver.com/search.naver";case"yandex":return"https://yandex.com/search/";case"sogou":return"https://www.sogou.com/web";case"brave":return"https://search.brave.com/search";case"reddit":return"https://www.reddit.com/search";case"twitter":return"https://twitter.com/search";case"youtube":return"https://www.youtube.com/results";case"amazon":return"https://www.amazon.com/s";default:return"https://www.google.com/search"}}function mt(e,t=!1,r=!1,o){const c={...o};delete c.limit,c.region&&c.region!=="wt-wt"&&(e==="google"?c.query=`location:${c.region} ${c.query}`:c.query=`${c.query}`,delete c.region),e!=="google"&&delete c.region;let f=c.query;switch(delete c.query,c.site&&(f=`site:${c.site} ${f}`),delete c.site,e){case"yahoo":{c.p=f;break}case"baidu":{if(t){c.word=f;break}c.wd=f;break}case"naver":case"sogou":{c.query=f;break}case"yandex":{c.text=f;break}case"bing":case"duckduckgo":case"brave":case"google":default:c.q=f}if(r)switch(e){case"google":{c.tbm="isch",c.udm="2";break}case"baidu":{c.tn="resultjson_com",c.word=f;break}}if(t)switch(e){case"google":{c.tbm="nws";break}case"baidu":{c.tn="news";break}}return new URLSearchParams({...c})}function ke(e,t){const r=dt(e,t.shouldSearchNews,t.shouldSearchImage),o=mt(e,t.shouldSearchNews,t.shouldSearchImage,{limit:t.limit,query:t.query,region:t.region,site:t.site});return`${r}?${o.toString()}`}function gt(e){const t=e.cloneNode(!0);return t.querySelectorAll('*[style*="display: none"]').forEach(o=>{o.parentNode.removeChild(o)}),t}function pt(e){try{const t=new DOMParser().parseFromString(e,"text/html"),r=gt(t.body),o={FORBID_TAGS:["style","noscript","script","svg","img","iframe","video"],USE_PROFILES:{html:!0}};let c=ve.sanitize(r,{...o});return wt(c)>me&&(c=c.slice(0,me)),c}catch{return e||""}}const me=1e6,wt=e=>new Blob([e]).size,yt=e=>{if(!e)return"";try{const t=/^(?:https?:\/\/)?(?:www\.)?((?:(?!www\.|\.).)+\.[-a-zA-Z0-9.]+)/gm,r=e.match(t);return(r?r[0]:"").toLowerCase()}catch{return e}},bt=e=>{try{return e?(e.search(/^http[s]?:\/\//)==-1&&(e="https://"+e),e):""}catch{return e||""}},M=(e,t=64)=>{try{const r=yt(e)||`${e==null?void 0:e.toLowerCase()}.com`;return`https://www.google.com/s2/favicons?sz=${t}&domain_url=${r}`}catch{return""}};function te(e){try{return e.trim().replaceAll(`
  `,"")||""}catch{return e||""}}function ge(e){try{const t=bt(e.trim().replaceAll("...","")),r=new URL(t).host.split(".");return r.length>=3?r[1]:r[0]}catch{return e}}function St(e){try{const t=e.match(/RU=([^/]+)/);return t&&t[1]?decodeURIComponent(t[1]):e}catch{return e||""}}const Lt=async(e,t=0,r=1500)=>{if(t>oe)return{html:"",status:301,success:!1,url:e};try{const o=await fetch(e,{redirect:"follow",signal:AbortSignal.timeout(r)});if(!o.ok){const f=o.type==="opaqueredirect"?301:o.status;throw{status:f,statusText:`Failed to fetch: ${f} ${o.statusText}`}}const c=await o.text();if(!c)throw{status:301,statusText:"Failed to fetch: 301"};return{html:c,status:o.status,success:!0,url:e}}catch(o){return o.status===301||o.status===429?{html:"",status:301,success:!1,url:e}:{html:`Could not fetch the page: ${o.message}. Make sure the URL is correct.`,status:404,success:!1,url:e}}};async function Ct(e,t){let r=0;const o=t.map(async f=>{try{const n=await e(ne.WEB_ACCESS.GET_HTML_FROM_URL,"GET_DTATA_FROM_URLS",{successfulGet:r,url:f.url});if(n.success&&n.status===200){r++;const l=pt(n.html);return{...f,html:l}}}catch{}return null});return(await Promise.all(o)).filter(f=>f!==null)}const At=(e,t,r=!1)=>{try{const o=new DOMParser().parseFromString(e,"text/html"),c=[];switch(t){case"google":{if(r){const n=o.querySelectorAll("#search #rso > div a[data-ved]");n&&n.forEach(l=>{try{const i=l.querySelectorAll("div[role=heading]");i&&i.forEach(a=>{var m,b;try{const S=a.textContent,A=((m=a.nextElementSibling)==null?void 0:m.textContent)||"";let w="";const u=l.querySelector("g-img");let d="";if(u){const y=u.querySelector("img");y&&(d=y.getAttribute("src")||"");const p=(b=u.parentElement)==null?void 0:b.querySelector("span");p&&(w=p.textContent||"")}if(!d){const y=l.querySelector("img");y&&(d=y.getAttribute("src")||"")}const h=l.getAttribute("href")??"";d&&d.includes("////")&&(d=M(h)),c.push({body:(A.includes("ago")?S:A)||S,from:w,imgLink:d,title:S,url:h})}catch{}})}catch{}})}else{const n=o.querySelectorAll("#search #rso > div");if(n.length===1){const l=o.querySelectorAll("#rso #kp-wp-tab-overview:not([style])");l&&l.forEach(a=>{try{const m=a.querySelectorAll('div[class*="K7khPe"]');m.length>0&&m.forEach(b=>{var S,A,w,u,d;try{const h=b.querySelector("a > h3");let y="",p="",E="",L="",O="";if(y=((S=b.querySelector("div.MUxGbd"))==null?void 0:S.textContent)||"",!y){const C=b.querySelector('div[jscontroller="SC7lYd"'),q=C==null?void 0:C.querySelector("div.ieodic");if(q){const x=q.querySelector("span");x&&(y=x.textContent||"")}if(!y){const x=(A=C==null?void 0:C.firstChild)==null?void 0:A.children[1];x&&(y=x.textContent||"")}}if(!y)try{const C=b.querySelector('div[style*="-webkit-line-clamp"]');y=C?(w=C.textContent)==null?void 0:w.trim():null}catch{}const D=h&&h.closest("a");O=(D==null?void 0:D.getAttribute("href"))??"",L=h==null?void 0:h.textContent;const k=h==null?void 0:h.nextElementSibling;p=k&&(k!=null&&k.lastElementChild)?(d=(u=k==null?void 0:k.lastElementChild)==null?void 0:u.firstElementChild)==null?void 0:d.textContent:"",E=M(O),c.push({body:y,from:p,imgLink:E,title:L,url:O})}catch{}})}catch{}});const i=o.querySelectorAll("#search #rso > div a[data-ved]");i&&i.forEach(a=>{try{const m=a.querySelectorAll("div[role=heading]");m&&m.forEach(b=>{var S,A;try{const w=b.textContent,u=((S=b.nextElementSibling)==null?void 0:S.textContent)||"";let d="";const h=a.querySelector("g-img");let y="";if(h){const E=h.querySelector("img");E&&(y=E.getAttribute("src")||"");const L=(A=h.parentElement)==null?void 0:A.querySelector("span");L&&(d=L.textContent||"")}if(!y){const E=a.querySelector("img");E&&(y=E.getAttribute("src")||"")}const p=a.getAttribute("href")??"";y&&y.includes("////")&&(y=M(p)),c.push({body:(u.includes("ago")?w:u)||w,from:d,imgLink:y,title:w,url:p})}catch{}})}catch{}})}else n.forEach(i=>{var a,m,b,S,A,w,u,d,h,y,p,E,L,O,D;try{const k=i.querySelector("a > h3");if(!k)return;const C=k.closest("a");let q=((m=(a=i.querySelector("div.MUxGbd"))==null?void 0:a.textContent)==null?void 0:m.trim())||"";if(q||(q=((u=(w=(A=(S=(b=C==null?void 0:C.parentElement)==null?void 0:b.parentElement)==null?void 0:S.parentElement)==null?void 0:A.nextSibling)==null?void 0:w.textContent)==null?void 0:u.trim())||""),q||(q=((L=(E=(p=(y=(h=(d=C==null?void 0:C.parentElement)==null?void 0:d.parentElement)==null?void 0:h.parentElement)==null?void 0:y.nextSibling)==null?void 0:p.nextSibling)==null?void 0:E.textContent)==null?void 0:L.trim())||""),!q){const T=i.querySelector('div[style*="-webkit-line-clamp"]');q=((O=T==null?void 0:T.textContent)==null?void 0:O.trim())||""}let x="";const _=k.nextSibling;if(_){const T=_.children;T&&T.length&&(x=T[T.length-1].textContent||"")}const j=C?C.getAttribute("href"):"";c.push({body:q||(k==null?void 0:k.textContent),from:x,imgLink:(D=_==null?void 0:_.querySelector("img"))==null?void 0:D.getAttribute("src"),title:k==null?void 0:k.textContent,url:j})}catch{}}),(o.querySelectorAll('div[jscontroller="SC7lYd"')||[]).forEach(i=>{var a,m,b;try{const S=i.querySelector("a");if(!S)return;const A=(S==null?void 0:S.getAttribute("href"))??"";if(c.find(p=>p.url===A))return;const w=i.querySelector("a > h3, h3, a");if(!w)return;let u=((a=i.querySelector("img"))==null?void 0:a.getAttribute("src"))||"";if(!u){const p=i.querySelector("g-img img");p&&(u=p.getAttribute("src")||"")}u&&u.includes("////")&&(u=M(A));let d=i.querySelector(".VuuXrf");if(!d){const p=i.querySelector("cite"),E=(m=p==null?void 0:p.parentElement)==null?void 0:m.parentElement;d=E==null?void 0:E.querySelector("span")}let h=null;const y=i.querySelector("div.ieodic");if(y&&(h=y.querySelector("span")),!h){const p=(b=i==null?void 0:i.firstChild)==null?void 0:b.children[1];p&&(h=p)}h||(h=i.querySelector('div[style*="-webkit-line-clamp"]')),c.push({body:(h==null?void 0:h.textContent)||"",from:(d==null?void 0:d.textContent)||"",imgLink:u,title:(w==null?void 0:w.textContent)||"",url:A})}catch{}})}break}case"baidu":{const n=o.querySelector("div#content_left");if(!n)break;n.querySelectorAll("div[class^=result]").forEach(i=>{var a,m,b,S,A;try{const w=i.querySelector("h3"),u=w?w.querySelector("a"):null;if(!u)return;let d=(a=i.querySelector("div[class*='description_']"))==null?void 0:a.textContent;d=d||((m=i.querySelector(".op_dict_content"))==null?void 0:m.textContent),d=d||((b=i.querySelector("div[class*='basis-info_']"))==null?void 0:b.textContent),d=d||((S=i.querySelector(".c-color-text"))==null?void 0:S.textContent),d=d||(w?w.nextElementSibling.nextElementSibling.textContent:null);const h=i.querySelector("a[class^='siteLink']");c.push({body:d??"",from:(h==null?void 0:h.textContent)||"",imgLink:((A=h==null?void 0:h.querySelector("img"))==null?void 0:A.getAttribute("src"))||M((u==null?void 0:u.getAttribute("href"))??"")||"",title:w?w==null?void 0:w.textContent:"",url:u?u.getAttribute("href")??"":""})}catch{}});break}case"yahoo":{r?new DOMParser().parseFromString(e,"text/html").querySelector("#main ol.searchCenterMiddle").querySelectorAll("li ul li").forEach(i=>{var y,p,E;const a=i.querySelector("h4.s-title a"),m=a.querySelector("img"),b=(m==null?void 0:m.getAttribute("src"))??"",S=i.querySelector(".s-source"),A=((y=S==null?void 0:S.textContent)==null?void 0:y.trim())??"",w=((p=a==null?void 0:a.textContent)==null?void 0:p.trim())??"",u=St((a==null?void 0:a.getAttribute("href"))??""),d=i.querySelector("p.s-desc"),h=((E=d==null?void 0:d.textContent)==null?void 0:E.trim())??"";c.push({body:h,from:A,imgLink:b,title:w,url:u})}):o.querySelectorAll('.algo:not([class*="ad"])').forEach(l=>{const i=l.querySelector("h3.title a");if(i){const a=i.getAttribute("href")||"",m=i.querySelector("span");let b=[];m&&(b=m.textContent.split(" â€º "));const S=l.querySelector(".compText"),A=S?S.textContent:"";c.push({body:A,from:ge(a)||b&&b[0]||"",imgLink:M(a)||"",title:i.getAttribute("aria-label")||"",url:a})}});break}}const f=[];for(let n=0;n<c.length;n++)try{const l={...c[n]};l.from||(l.from=ge(l.url)||""),l.from&&(l.from=l.from.replace(/\.[^.]*$/,""),l.from=te(l.from)||""),!l.imgLink&&l.url&&(l.imgLink=M(l.url)||""),l.body=te(l.body)||"",l.title=te(l.title)||"",f.push(l)}catch{}return f}catch{return[]}};async function X({engine:e,getFromBackground:t,query:r,shouldSearchImage:o=!1,shouldSearchNews:c=!1,timerange:f=null}){try{const n=ke(e,{btf:f,csp:"1",ei:"UTF-8",limit:oe,nojs:"1",query:r,region:"wt-wt",shouldSearchImage:o,shouldSearchNews:c,site:null});return await t(ne.WEB_ACCESS.GET_HTML_FROM_URL,"GET_SEARCH_ENGINE_DOM",{signal:null,timeout:4e3,url:n})}catch{}return{html:"",status:404,success:!1,url:""}}const Dt=async(e,t,r,o,c=!1,f)=>{var h,y,p,E,L,O,D,k;let n={response:(((y=(h=r.action.message)==null?void 0:h.metadata)==null?void 0:y.context)??"")+" "+((p=r.action.message)==null?void 0:p.content),shouldGoogle:!0,shouldSearchNews:!1,timerange:null},l=!0;(!f||!(((L=(E=r.action.message)==null?void 0:E.content)==null?void 0:L.length)+(((k=(D=(O=r.action.message)==null?void 0:O.metadata)==null?void 0:D.context)==null?void 0:k.length)??0)<=60))&&l&&(n=await qe(t,r)),n.shouldGoogle||(c=!0);let{html:i,success:a,url:m}=await X({engine:o,getFromBackground:e,query:(n==null?void 0:n.response)??r.action.message.content,shouldSearchNews:n==null?void 0:n.shouldSearchNews,timerange:n==null?void 0:n.timerange});if(a||(o=o==="google"?"yahoo":"google",{html:i,success:a,url:m}=await X({engine:o,getFromBackground:e,query:(n==null?void 0:n.response)??r.action.message.content,shouldSearchNews:n==null?void 0:n.shouldSearchNews,timerange:n==null?void 0:n.timerange})),a||(o="baidu",{html:i,success:a,url:m}=await X({engine:o,getFromBackground:e,query:(n==null?void 0:n.response)??r.action.message.content,shouldSearchNews:n==null?void 0:n.shouldSearchNews,timerange:n==null?void 0:n.timerange})),!a)return{data:[],decisionResponse:n};const b=new DOMParser().parseFromString(i,"text/html").querySelector("body"),S=(b==null?void 0:b.innerHTML)??"",A=At(i,o,n==null?void 0:n.shouldSearchNews);if(c){const C=A.map(q=>({...q,html:""}));try{C.push({body:se(b)||"Search results",from:o,html:"",imgLink:M("https://www.google.com/"),title:"Search Results",url:m})}catch{}return{data:C,decisionResponse:n}}const w=await Ct(e,A);w.push({body:"Search results",from:o,html:S,imgLink:M("https://www.google.com/"),title:"Search Results",url:m});const u=await xe();return((u==null?void 0:u.useNewDomClean)===void 0||(u==null?void 0:u.useNewDomClean)===null?!0:u==null?void 0:u.useNewDomClean)&&w.forEach(C=>{try{const q=new DOMParser().parseFromString(C.html,"text/html").querySelector("body");C.html="";let x;try{x=se(q)}catch{x=""}C.body=x??C.body}catch{}}),{data:w,decisionResponse:n}};async function Ot(e){const t=new AbortController,r=t.signal,o=setTimeout(()=>{t.abort()},5e3);try{const f=await fetch(e,{headers:{"Content-Type":"text/html","User-Agent":"Chrome/90.0.4430.212"},method:"GET",signal:r});if(!f.ok&&f.status!==200)return"";const n=await f.text();return clearTimeout(o),n}catch{return clearTimeout(o),""}}async function pe(e,t){const r=new DOMParser().parseFromString(e,"text/html").querySelectorAll(t),o=[];return r==null||r.forEach(c=>{var f,n,l;try{const i=c==null?void 0:c.getAttribute("data-id"),a=(n=(f=c==null?void 0:c.children[1])==null?void 0:f.children[0])==null?void 0:n.children[0].getAttribute("data-src");a&&o.push({id:i,link:a})}catch{const a=(l=c==null?void 0:c.children[0])==null?void 0:l.children[0].getAttribute("data-src");a&&o.push({link:a})}}),o}async function we(e,t,r){return await X({engine:e,getFromBackground:t,query:r,shouldSearchImage:!0,shouldSearchNews:!1,timerange:"m"})}async function Ut(e,t){let r=[],{html:o,success:c,url:f}=await we("google",e,t);if(c)r=await pe(o,'div[jsname="N9Xkfe"][role="listitem"]');else if({html:o,success:c,url:f}=await we("yahoo",e,t),c)r=await pe(o,'li[data-bns="API"]');else{const n=ke("baidu",{btf:"m",csp:"1",ei:"UTF-8",limit:oe,nojs:"1",query:t,region:"wt-wt",shouldSearchImage:!0,shouldSearchNews:!1,site:null}),l=await e(ne.FETCH_TEXT,"FETCH_IMAGES",{options:{headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8","Accept-Encoding":"gzip, deflate, br","Accept-Language":"en-US,en;q=0.5",Connection:"keep-alive",Host:"image.baidu.com"},method:"GET"},url:n});if(!l)return r;try{JSON.parse(l).data.forEach(a=>{const m=a.middleURL;m&&r.push(m)})}catch{JSON.parse(ht(l)).data.forEach(m=>{const b=m.middleURL;b&&r.push(b)})}}return r.slice(0,11),r.slice(0,11)}export{M as a,At as b,Lt as c,Ot as e,Ut as f,Dt as g};
