import{r as o,j as a,c as H}from"./client-45b27fd3.js";import{g as B}from"./index-9b1f0f42.js";import{L as O}from"./hook-ae816606.js";import{r as j,U as P,i as G}from"./index-825701e8.js";import{a as D,A as Y}from"./index-37dc4817.js";import{c as z}from"./index-203ce83a.js";import{T as F}from"./webAccessTooltip-5740d933.js";import{f as q}from"./analytics-46c41402.js";import{i as V,s as W,n as N,P as x,U as _,l as $,Y as v}from"./postMessageConstants-347e1d65.js";import{u as X}from"./useTranslation-c38a45bb.js";import{m as Z}from"./motion-2f15212b.js";import{I as J}from"./IconLoader-e94e6080.js";import{A as K}from"./index-39fb8d8a.js";import{c as Q}from"./index-5c33a703.js";import"./createReactComponent-d14705e3.js";const tt={hidden:{opacity:0,transition:{duration:.3},transitionEnd:{display:"none"}},visible:{display:"flex",opacity:1,transition:{duration:.3}}},et={adsState:!1,queryCost:0,summaryState:null},nt=()=>{const{t}=X(),n=o.useContext(D),{isAuthenticated:c,usageDetails:r}=n,u=V(),[m,p]=o.useState(0),[E,f]=o.useState(!0),[L,g]=o.useState(!1),[T,S]=o.useState(!1),y=o.useRef(null),[w,A]=o.useState(!1),[b,R]=o.useState(et),[k,I]=o.useState(!1),U=e=>{if(e.preventDefault(),!T){p(10),g(!0);const s=$();y.current=setInterval(()=>{p(l=>l<80?l+10:(clearInterval(y.current),85))},s)}window.parent.postMessage({action:N.INITIATE_COMMENT_PROCESS,type:x.FROM_COMMENT_SECTION_HIGHLIGHTS_BUTTON},"*"),q({eventName:"GenerateYoutubeHighlightsButton",eventType:"Button",feature:"YoutubeSummarizer",firedFromFile:"src/features/youtubeSummarizer/YoutubeCommentSectionButton"})};if(o.useEffect(()=>{const e=s=>{if(s.data.type===x.FROM_YT_SUMMARIZER)switch(s.data.action){case v.SET_HIGHLIGHTS_SUCCESS:T?(f(!1),S(!0)):(p(100),clearInterval(y.current),setTimeout(()=>{f(!1)},3e3),setTimeout(()=>{p(0)},3500),S(!0)),g(!1);break;case v.UPDATE_COST_AND_ADS_STATE:R(s.data.context),s.data.context.summaryState===_.SUCCESS&&S(!0);break;case v.RESET_HIGHLIGHTS_BUTTON:p(0),clearInterval(y.current),f(!0),g(!1),S(!1);break}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[T]),o.useEffect(()=>{let e;const s=document.getElementById("comment-dialog");return s&&(e=new MutationObserver((l,h)=>{for(const d of l)if(d.addedNodes){for(const C of d.addedNodes)if(C instanceof HTMLElement&&C.id==="contenteditable-root"){A(!0),h.disconnect();return}}})),e.observe(s,{childList:!0,subtree:!0}),()=>{e&&e.disconnect()}},[]),o.useEffect(()=>{if(w){const e=document.getElementById("contenteditable-root"),s=document.querySelector("#buttons #cancel-button"),l=document.querySelector("#buttons #submit-button"),h=()=>{e.innerText.trim()===""?f(!0):f(!1)},d=()=>{f(!0)};return e.addEventListener("input",h),s.addEventListener("click",d),l.addEventListener("click",d),()=>{e.removeEventListener("input",h),s.removeEventListener("click",d),l.removeEventListener("click",d)}}},[w]),o.useEffect(()=>{W({action:N.GET_SHARED_STATE_ON_MOUNTING,type:x.FROM_COMMENT_SECTION_HIGHLIGHTS_BUTTON})},[]),o.useEffect(()=>{let e="";const s=new MutationObserver(h=>{if(location.href!==e)if(e=location.href,(document.domain.replace("www.","")||location.hostname.replace("www.",""))==="youtube.com"&&location.pathname.startsWith("/shorts")){I(!0);return}else I(!1)}),l=document.querySelector("title");s.observe(l,{childList:!0})},[]),!k)return c&&a.jsxs(Z.button,{className:z("border-cornblue-500 group absolute right-[16px] top-[-20px] flex w-[260px] items-center justify-center whitespace-nowrap rounded-[4px] border px-3 py-2 text-sm font-semibold text-neutral-100",!E&&"cursor-text",u==="dark"&&"bg-background dark"),disabled:!E,type:"button",onClick:U,initial:"visible",animate:E?"visible":"hidden",variants:tt,children:[a.jsx("div",{style:{width:`${m}%`},className:"bg-cornblue-600/30 absolute left-0 top-0 h-full transition-all duration-300"}),a.jsx("span",{className:"relative flex w-full items-center justify-center text-zinc-800 dark:text-zinc-100",children:L?a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[" ",a.jsx("span",{className:"animate-loader-spin relative",children:a.jsx(J,{className:"stroke-black dark:stroke-white",width:18,height:18})}),t("yt_lib.highlights")]}):t(m===100?"yt_lib.highlights_success":"yt_lib.cmnt_highlights")}),a.jsx(K,{children:a.jsx(F,{zIndex:300,position:"top",children:b.adsState?t("yt_lib.wait_ad"):b.summaryState===_.SUCCESS?t("yt_lib.highlights_gen"):b.summaryState===_.LOADING?t("yt_lib.highlights_gen1"):`${t("yt_lib.will_use")} ${b.queryCost??4} ${j(r.type)?t("yt_lib.words"):t("yt_lib.free_summ")}`})})]})};let i=null;const st=()=>{const[t={ytSummarizer:{visible:!1}}]=O({instance:new B({area:"local"}),key:"UserSettings"});return t.ytSummarizer.visible?a.jsx(Y,{children:a.jsx(nt,{})}):null};function ot(){return new Promise(t=>{const n=new MutationObserver(G(()=>{const r=document.querySelector("ytd-comments");r&&(t(r),n.disconnect())},50)),c=document.getElementById("page-manager");n.observe(c,{childList:!0,subtree:!0})})}const it=async t=>{const n=document.createElement("merlin-component");n.id="merlin-yt-comment-button",n.className="merlin yt-comment-button";const c=n.attachShadow({mode:"open"}),r=document.createElement("style");r.textContent=`${Q}
:host(#merlin-yt-comment-button) {
    all: initial; /* 1st rule so subsequent properties are reset. */
    margin: 0;
    padding: 0;
    width: 100%;
    position: absolute;
    box-sizing: border-box;
}
.ytReactAppRoot {
    position: relative;
  z-index: 2000;
  font-family:
		"Hanken Grotesk",
		system-ui,
		-apple-system,
		BlinkMacSystemFont,
		Ubuntu,
		sans-serif !important;
}
`;const u=document.createElement("div");u.id="ytReactAppRoot",u.className="ytReactAppRoot",c.appendChild(r),c.appendChild(u),t(n),H(u).render(a.jsx(st,{}))},M=()=>{i=new MutationObserver(n=>{n.map(c=>c.addedNodes.forEach(r=>{var u;r.nodeName==="YTD-COMMENT-SIMPLEBOX-RENDERER"&&((u=i==null?void 0:i.disconnect)==null||u.call(i),it(m=>r.appendChild(m)))}))});const t=document.querySelector("ytd-comments");i==null||i.observe(t,{childList:!0,subtree:!0})},rt=()=>{let t="",n=!0;const c=new MutationObserver(u=>{var m;location.href!==t&&(t=location.href,n||((m=i==null?void 0:i.disconnect)==null||m.call(i),M()),n=!1)}),r=document.querySelector("title");c.observe(r,{childList:!0})},at=async()=>{const t=await P();t&&!t.summarizer.youtube.visible||(await ot(),M(),rt())};at();
