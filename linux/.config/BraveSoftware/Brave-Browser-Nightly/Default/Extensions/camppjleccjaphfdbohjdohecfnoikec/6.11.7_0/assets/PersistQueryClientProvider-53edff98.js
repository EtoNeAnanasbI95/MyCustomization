import{r as o,j as v}from"./client-45b27fd3.js";function P(e){return{mutationKey:e.options.mutationKey,state:e.state,...e.options.scope&&{scope:e.options.scope},...e.meta&&{meta:e.meta}}}function E(e){var t;return{state:e.state,queryKey:e.queryKey,queryHash:e.queryHash,...e.state.status==="pending"&&{promise:(t=e.promise)==null?void 0:t.catch(r=>Promise.reject(new Error("redacted")))},...e.meta&&{meta:e.meta}}}function M(e){return e.state.isPaused}function R(e){return e.state.status==="success"}function w(e,t={}){var c,n;const r=t.shouldDehydrateMutation??((c=e.getDefaultOptions().dehydrate)==null?void 0:c.shouldDehydrateMutation)??M,s=e.getMutationCache().getAll().flatMap(u=>r(u)?[P(u)]:[]),i=t.shouldDehydrateQuery??((n=e.getDefaultOptions().dehydrate)==null?void 0:n.shouldDehydrateQuery)??R,a=e.getQueryCache().getAll().flatMap(u=>i(u)?[E(u)]:[]);return{mutations:s,queries:a}}function S(e,t,r){if(typeof t!="object"||t===null)return;const s=e.getMutationCache(),i=e.getQueryCache(),a=t.mutations||[],c=t.queries||[];a.forEach(({state:n,...u})=>{var d,f;s.build(e,{...(d=e.getDefaultOptions().hydrate)==null?void 0:d.mutations,...(f=r==null?void 0:r.defaultOptions)==null?void 0:f.mutations,...u},n)}),c.forEach(({queryKey:n,state:u,queryHash:d,meta:f,promise:l})=>{var m,g,p;let y=i.get(d);if(y){if(y.state.dataUpdatedAt<u.dataUpdatedAt){const{fetchStatus:h,...C}=u;y.setState(C)}}else y=i.build(e,{...(m=e.getDefaultOptions().hydrate)==null?void 0:m.queries,...(g=r==null?void 0:r.defaultOptions)==null?void 0:g.queries,queryKey:n,queryHash:d,meta:f},{...u,fetchStatus:"idle"});if(l){const h=(p=e.getDefaultOptions().hydrate)==null?void 0:p.transformPromise,C=(h==null?void 0:h(Promise.resolve(l)))??l;y.fetch(void 0,{initialPromise:C})}})}var x=o.createContext(void 0),T=e=>{const t=o.useContext(x);if(e)return e;if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},j=({client:e,children:t})=>(o.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),v.jsx(x.Provider,{value:e,children:t})),D=o.createContext(!1),U=()=>o.useContext(D),O=D.Provider,q=["added","removed","updated"];function Q(e){return q.includes(e)}async function A({queryClient:e,persister:t,maxAge:r=1e3*60*60*24,buster:s="",hydrateOptions:i}){try{const a=await t.restoreClient();if(a)if(a.timestamp){const c=Date.now()-a.timestamp>r,n=a.buster!==s;c||n?t.removeClient():S(e,a.clientState,i)}else t.removeClient()}catch{t.removeClient()}}async function b({queryClient:e,persister:t,buster:r="",dehydrateOptions:s}){const i={buster:r,timestamp:Date.now(),clientState:w(e,s)};await t.persistClient(i)}function I(e){const t=e.queryClient.getQueryCache().subscribe(s=>{Q(s.type)&&b(e)}),r=e.queryClient.getMutationCache().subscribe(s=>{Q(s.type)&&b(e)});return()=>{t(),r()}}var H=({client:e,children:t,persistOptions:r,onSuccess:s,...i})=>{const[a,c]=o.useState(!0),n=o.useRef({persistOptions:r,onSuccess:s}),u=o.useRef(!1);return o.useEffect(()=>{n.current={persistOptions:r,onSuccess:s}}),o.useEffect(()=>{const d={...n.current.persistOptions,queryClient:e};return u.current||(u.current=!0,c(!0),A(d).then(async()=>{var f,l;try{await((l=(f=n.current).onSuccess)==null?void 0:l.call(f))}finally{c(!1)}})),a?void 0:I(d)},[e,a]),v.jsx(j,{client:e,...i,children:v.jsx(O,{value:a,children:t})})};export{H as P,U as a,T as u};
